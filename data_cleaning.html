<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Stata to R</title>

<!-- prism.js -->
<link href="https://cdn.jsdelivr.net/npm/prismjs@1.25.0/themes/prism.css" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.25.0/components/prism-core.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.25.0/plugins/autoloader/prism-autoloader.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.25.0/plugins/normalize-whitespace/prism-normalize-whitespace.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.25.0/components/prism-r.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.25.0/components/prism-stan.js"></script>

<!-- tailwindCSS -->
<script src="https://cdn-tailwindcss.vercel.app/3.0.0-alpha.2?plugins=forms@0.4.0-alpha.2,typography@0.5.0-alpha.3,aspect-ratio@0.3.0,line-clamp@0.2.2"></script>
<style type="text/tailwindcss">
        pre[class*="language-"] {
            @apply bg-white px-4 py-4 lg:py-2 m-0;
        }

        li.toc-dot:before {
            content: "";
            width: 16px;
            height: 16px;
            position: absolute;
            top: 0px;
            left: -10px;
            background: white;
            border: 2px solid #4c807b;
            box-shadow: 2px 2px 0px #c1dddb;
            border-radius: 50%;
        }
      </style>
</head>
<body>
  <div class="bg-[#fdf9f3] px-4 md:px-8">
    <div class="w-full max-w-[96rem] mx-auto min-h-screen">
      <div class="flex flex-col xl:gap-x-8 xl:flex-row">
        <script>/* 
Prism.plugins.NormalizeWhitespace.setDefaults({
    'remove-trailing': true, 
    'remove-indent': true, 
    'left-trim': true, 
    'right-trim': true
});
*/

window.onload = function(e){ 
// Display table of contents with menu button
document.getElementById("menu-x").onclick = function () {
    document.getElementById("toc").classList.toggle("hidden");
    document.getElementById("menu-hamburger").classList.toggle("hidden");
    document.getElementById("menu-x").classList.toggle("hidden");
};
document.getElementById("menu-hamburger").onclick = function () {
    document.getElementById("toc").classList.toggle("hidden");
    document.getElementById("menu-hamburger").classList.toggle("hidden");
    document.getElementById("menu-x").classList.toggle("hidden");
};
}</script>
        <div class="flex max-h-screen flex-col xl:px-2 w-full xl:w-[24rem] sticky bg-[#fdf9f3] xl:h-screen top-0 pt-8 md:pt-16 pb-4">
          <div class="flex flex-row space-between items-center pb-4">
            <a class="flex-grow" href="index.html">
              <h1 class="text-3xl flex flex-row items-center gap-x-2 text-[#3d6762] tracking-wide">
                 Stata
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-[#315450]" fill="none" viewbox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 9l3 3m0 0l-3 3m3-3H8m13 0a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                 R
              </h1>
            </a>
            <div id="menu-button" class="xl:hidden cursor-pointer">
              <svg id="menu-hamburger" xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-[#315450]" fill="none" viewbox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
              </svg>
              <svg id="menu-x" xmlns="http://www.w3.org/2000/svg" class="hidden h-8 w-8 text-[#993b27]" fill="none" viewbox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </div>
          </div>
          <div id="toc" class="hidden flex-grow w-full bg-[#fdf9f3] sticky overflow-y-scroll xl:overflow-y-auto max-h-screen xl:block xl:relative">
            <div>
              <h1 class="text-2xl font-semibold tracking-tight mt-8 text-[#315450]">
                <a href="data_cleaning.html">data.table</a>
              </h1>
              <ul class="mt-4 relative">
                <li class="toc-dot flex flex-col relative border-l-2 border-[#c1dddb] ml-2 pl-4 pb-4 hover:border-[#5b9a94] group cursor-pointer">
                  <a href="data_cleaning.html#data" class="font-medium font-light leading-4 mb-2 group-hover:font-normal">Data I/O</a>
                </li>
                <li class="toc-dot flex flex-col relative border-l-2 border-[#c1dddb] ml-2 pl-4 pb-4 hover:border-[#5b9a94] group cursor-pointer">
                  <a href="data_cleaning.html#sort" class="font-medium font-light leading-4 mb-2 group-hover:font-normal">Sort &amp; rename</a>
                </li>
                <li class="toc-dot flex flex-col relative border-l-2 border-[#c1dddb] ml-2 pl-4 pb-4 hover:border-[#5b9a94] group cursor-pointer">
                  <a href="data_cleaning.html#subset" class="font-medium font-light leading-4 mb-2 group-hover:font-normal">Subset</a>
                </li>
                <li class="toc-dot flex flex-col relative border-l-2 border-[#c1dddb] ml-2 pl-4 pb-4 hover:border-[#5b9a94] group cursor-pointer">
                  <a href="data_cleaning.html#modify" class="font-medium font-light leading-4 mb-2 group-hover:font-normal">Modify</a>
                </li>
                <li class="toc-dot flex flex-col relative border-l-2 border-[#c1dddb] ml-2 pl-4 pb-4 hover:border-[#5b9a94] group cursor-pointer">
                  <a href="data_cleaning.html#collapse" class="font-medium font-light leading-4 mb-2 group-hover:font-normal">Collapse</a>
                </li>
                <li class="toc-dot flex flex-col relative border-l-2 border-[#c1dddb] ml-2 pl-4 pb-4 hover:border-[#5b9a94] group cursor-pointer">
                  <a href="data_cleaning.html#reshape" class="font-medium font-light leading-4 mb-2 group-hover:font-normal">Reshape</a>
                </li>
                <li class="toc-dot flex flex-col relative border-l-2 border-transparent ml-2 pl-4 pb-4 hover:border-transparent group cursor-pointer">
                  <a href="data_cleaning.html#merge" class="font-medium font-light leading-4 mb-2 group-hover:font-normal">Merge</a>
                </li>
              </ul>
            </div>
            <div>
              <h1 class="text-2xl font-semibold tracking-tight mt-8 text-[#315450]">
                <a href="regression.html">fixest</a>
              </h1>
              <ul class="mt-4 relative">
                <li class="toc-dot flex flex-col relative border-l-2 border-[#c1dddb] ml-2 pl-4 pb-4 hover:border-[#5b9a94] group cursor-pointer">
                  <a href="regression.html#formula" class="font-medium font-light leading-4 mb-2 group-hover:font-normal">Formula Creation</a>
                </li>
                <li class="toc-dot flex flex-col relative border-l-2 border-[#c1dddb] ml-2 pl-4 pb-4 hover:border-[#5b9a94] group cursor-pointer">
                  <a href="regression.html#std_errors" class="font-medium font-light leading-4 mb-2 group-hover:font-normal">Standard Errors</a>
                </li>
                <li class="toc-dot flex flex-col relative border-l-2 border-[#c1dddb] ml-2 pl-4 pb-4 hover:border-[#5b9a94] group cursor-pointer">
                  <a href="regression.html#post" class="font-medium font-light leading-4 mb-2 group-hover:font-normal">Postestimation</a>
                </li>
                <li class="toc-dot flex flex-col relative border-l-2 border-[#c1dddb] ml-2 pl-4 pb-4 hover:border-[#5b9a94] group cursor-pointer">
                  <a href="regression.html#panel" class="font-medium font-light leading-4 mb-2 group-hover:font-normal">Panel Data</a>
                </li>
                <li class="toc-dot flex flex-col relative border-l-2 border-transparent ml-2 pl-4 pb-4 hover:border-transparent group cursor-pointer">
                  <a href="regression.html#iv" class="font-medium font-light leading-4 mb-2 group-hover:font-normal">Instrumental Variables</a>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="flex-grow min-h-screen py-16 pb-96">
          <div class="w-full max-w-5xl mx-auto py-12">
            <div class="pb-4 border-b-2 border-gray-600">
              <h1 class="text-black text-4xl font-bold">
                Cleaning data with 
                <a href="https://rdatatable.gitlab.io/data.table" class="text-emerald-800 italic font-semibold">data.table</a>
              </h1>
            </div>
            <div class="max-w-prose prose pt-8 text-gray-700 text-normal md:text-lg xl:text-xl">
              <p>
                <a href="https://rdatatable.gitlab.io/data.table" class="text-emerald-800 font-semibold underline">data.table</a>
                 (by Matt Dowle, Arun Srinivasan 
                <span class="italic">et. al.</span>
                ) is a package written in C to make cleaning data fast, easy and incredibly powerful. All of the examples below will use real-life 2014 New York air traffic data, which we'll import in the 
                <a href="#data" class="text-emerald-800 font-semibold underline">Data I/O</a>
                 section.
              </p>
              <p>
                Before continuing, make sure that you have installed 
                <span class="font-semibold">data.table</span>
                . You only have to do this 
                <span class="italic">once</span>
                 (or as often as you want to update the package).
              </p>
              <p>
                <code class="before:content-[&#39;&#39;] after:content-[&#39;&#39;]">
                  <pre class="language-r"># Install from CRAN (recommended) 
install.packages(data.table)

# Install the development version from GitHub (advanced) 
# Requires Rtools and the remotes package 
# remotes::install_github('Rdatatable/data.table')</pre>
                </code>
              </p>
              <p>
                Once 
                <span class="font-semibold">data.table</span>
                 is installed, don't forget to load it whenever you want to use it. Unlike in Stata, you have to re-load a package every time you start a new R session.
              </p>
              <p>
                <code class="before:content-[&#39;&#39;] after:content-[&#39;&#39;]">
                  <pre class="language-r"># Load data.table into our current R session 
library(data.table)</pre>
                </code>
              </p>
            </div>
          </div>
          <div class="w-full max-w-5xl mx-auto py-12">
            <div class="pb-4 border-b-2 border-gray-600">
              <h1 class="text-black text-4xl font-bold">Introduction to data.table</h1>
            </div>
            <div class="max-w-prose prose pt-8 text-gray-700 text-normal md:text-lg xl:text-xl">
              <p>
                The 
                <a href="https://rdatatable.gitlab.io/data.table" class="text-emerald-800 font-semibold underline">data.table</a>
                 package centers around 
                <span class="font-semibold">data.tables</span>
                , which are highly efficient data frames that can be manipulated using the package's concise syntax. For example, say we have a 
                <span class="font-semibold">data.table</span>
                 called 
                <span class="font-semibold">dat</span>
                 (you can call it whatever you want). Then we can manipulate it by putting arguments into its square brackets, i.e. 
                <span class="font-semibold">dat[]</span>
                . The three main components of a 
                <span class="font-semibold">data.table</span>
                 operation are 
                <span class="font-semibold">i, j,</span>
                 and 
                <span class="font-semibold">by,</span>
                 which go in the order 
                <span class="font-semibold">dat[i, j, by]</span>
                 (note you don't have to specify the latter two if you're not currently using them.)
                <ul>
                  <li>
                    <span class="font-semibold">i,</span>
                     the first component, selects the 
                    <span class="italic">rows</span>
                     of the 
                    <span class="font-semibold">data.table</span>
                     that you'll be working with, like how in Stata the 
                    <span class="font-semibold">if</span>
                     or 
                    <span class="font-semibold">in</span>
                     command options let you refer to certain rows.
                  </li>
                  <li>
                    <span class="font-semibold">j,</span>
                     the second component, both selects and operates on the 
                    <span class="italic">columns</span>
                     of the 
                    <span class="font-semibold">data.table,</span>
                     like how in Stata the 
                    <span class="font-semibold">keep</span>
                     or 
                    <span class="font-semibold">drop</span>
                     commands select specific columns of your data, or how 
                    <span class="font-semibold">generate</span>
                     or 
                    <span class="font-semibold">replace</span>
                     create or modify columns in your data.
                  </li>
                  <li>
                    <span class="font-semibold">by,</span>
                     the third component, gives the variable(s) designating groups that you'll be doing your calculations within, like how in Stata you can precede a command with 
                    <span class="font-semibold">bysort.</span>
                  </li>
                </ul>
              </p>
              <p>
                Like Stata, 
                <span class="font-semibold">data.table</span>
                also provides some special shortcut symbols for common operations. For example, `_N` in Stata is equivalent to `.N` in 
                <span class="font-semibold">data.table</span>
                . We'll see more examples in cheatsheat below, but we do want to quickly highlight one special symbol in particular: 
                <span class="font-semibold">.SD</span>
                 refers to the (S)ubset of (D)ata you're working with. This can be used to do complex within-group calculations when you have 
                <span class="font-semibold">by</span>
                 specified, but more often it's a way to perform column operations on lots of columns with one line of code. By default, 
                <span class="font-semibold">.SD</span>
                 refers to all columns not in 
                <span class="font-semibold">by,</span>
                 but you can specify the columns you want with the 
                <span class="font-semibold">.SDcols</span>
                 argument. Again, we'll see a bunch of examples below.
              </p>
              <p>
                <span class="font-semibold">data.table</span>
                 uses these simple components very flexibly. The upshot is that you can perform complicated operations in a single line of concise 
                <span class="font-semibold">data.table</span>
                 code, which may have required multiple commands in other languages or libraries to accomplish. But even if you aren't doing anything fancy, 
                <span class="font-semibold">data.table</span>
                 has you covered with a stable set of functions that can be deployed on virtually any data wrangling task.
              </p>
              <p>
                Finally,  
                <span class="font-semibold">data.table</span>
                 is extremely fast. It has long set the standard for in-memory data wrangling 
                <a href="https://h2oai.github.io/db-benchmark" class="text-emerald-800 font-semibold underline">benchmarks</a>
                 across a variety of libraries and languages. You will likely see an order(s) of magnitude performance difference as you compare the code chunks below. As a bonus for Stata users, many 
                <span class="font-semibold">data.table</span>
                 operations can be done 
                <span class="italic">in-place,</span>
                 which means that it will affect 
                <span class="italic">only the parts you're actually changing,</span>
                 without wasting memory and time on the parts that aren't being changed. Any time in the below cheat sheet you see a function with the word
                <span class="font-semibold">set</span>
                 in it, or the 
                <span class="font-semibold">:=</span>
                 operator, that's an in-place operation. Speedy!
              </p>
            </div>
          </div>
          <div class="w-full max-w-5xl mx-auto py-12">
            <div class="pb-4 border-b-2 border-gray-600">
              <h1 class="text-black text-4xl font-bold">Cheat Sheet</h1>
            </div>
          </div>
          <div id="data">
            <div class="w-full max-w-5xl mx-auto py-12">
              <div class="flex flex-row">
                <h2 class="inline-block font-bold text-2xl text-[#315450]">Data I/O</h2>
              </div>
              <div class="grid grid-cols-1 xl:grid-cols-2 xl:gap-x-8 justify-start gap-y-4 mt-8">
                <div class="xl:col-span-2">
                  <h2 class="text-gray-600 text-lg font-semibold">Read and write .csv</h2>
                </div>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-stata">import delimited using "https://raw.githubusercontent.com/Rdatatable/data.table/master/vignettes/flights14.csv", clear 
export delimited using "flightdata.csv", replace</code>
                </pre>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-r">dat = fread('https://raw.githubusercontent.com/Rdatatable/data.table/master/vignettes/flights14.csv')
fwrite(dat, 'flightdata.csv')</code>
                </pre>
              </div>
              <div class="grid grid-cols-1 xl:grid-cols-2 xl:gap-x-8 justify-start gap-y-4 mt-8">
                <div class="xl:col-span-2">
                  <h2 class="text-gray-600 text-lg font-semibold">Read and write .dta</h2>
                </div>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-stata">* .dta is Stata's native (proprietary) filetype 
use "filename.dta", clear 


save "filename.dta", replace</code>
                </pre>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-r"># These commands require the `haven` package 
dat = haven::read_dta('filename.dta') 
setDT(dat) # Or: dat = as.data.table(dat) 
 
haven::write_dta(dat, 'filename.dta')</code>
                </pre>
              </div>
            </div>
          </div>
          <div id="sort">
            <div class="w-full max-w-5xl mx-auto py-12">
              <div class="flex flex-row">
                <h2 class="inline-block font-bold text-2xl text-[#315450]">Sort &amp; rename</h2>
              </div>
              <div class="grid grid-cols-1 xl:grid-cols-2 xl:gap-x-8 justify-start gap-y-4 mt-8">
                <div class="xl:col-span-2">
                  <h2 class="text-gray-600 text-lg font-semibold">Sort rows</h2>
                </div>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-stata">sort air_time 
sort air_time dest 
sort -air_time

</code>
                </pre>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-r">setorder(dat, air_time) 
setorder(dat, air_time, dest) 
setorder(dat, -air_time)</code>
                </pre>
              </div>
              <div class="grid grid-cols-1 xl:grid-cols-2 xl:gap-x-8 justify-start gap-y-4 mt-8">
                <div class="xl:col-span-2">
                  <h2 class="text-gray-600 text-lg font-semibold">Sort columns</h2>
                </div>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-stata">order month day</code>
                </pre>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-r">setcolorder(dat, c('month','day'))</code>
                </pre>
              </div>
              <div class="grid grid-cols-1 xl:grid-cols-2 xl:gap-x-8 justify-start gap-y-4 mt-8">
                <div class="xl:col-span-2">
                  <h2 class="text-gray-600 text-lg font-semibold">Rename columns</h2>
                </div>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-stata">* rename (old) (new) 

rename arr_delay arrival_delay 
rename (carrier origin) (carrier_code origin_code) 


rename arr_* arrival_*</code>
                </pre>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-r"># setnames(dat, old = ..., new = ...) 

setnames(dat, 'arr_delay', 'arrival_delay') 
setnames(dat, c('carrier','origin'), c('carrier_code','origin_code')) 

# Easiest just to reassign names using gsub 
names(dat) = gsub('arr_', 'arrival_', names(dat))</code>
                </pre>
              </div>
            </div>
          </div>
          <div id="subset">
            <div class="w-full max-w-5xl mx-auto py-12">
              <div class="flex flex-row">
                <h2 class="inline-block font-bold text-2xl text-[#315450]">Subset</h2>
              </div>
              <div class="grid grid-cols-1 xl:grid-cols-2 xl:gap-x-8 justify-start gap-y-4 mt-8">
                <div class="xl:col-span-2">
                  <h2 class="text-gray-600 text-lg font-semibold">Subset rows</h2>
                </div>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-stata">keep in 1/200 
keep if day &gt; 5 &amp; day &lt; 10
keep if inrange(day,5,10)
keep if origin == "LGA"
keep if regex(origin,"LGA") 
keep if inlist(month,3,4,11,12) 
keep if inlist(origin,"JFK","LGA") 
drop if month == 1</code>
                </pre>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-r">dat1 = dat[1:200] 
dat1 = dat[day &gt; 5 &amp; day &lt; 10] 
dat1 = dat[between(day,5,10)] # Or: dat1 = dat[day %in% 5:10] 
dat1 = dat[origin=='LGA']
dat1 = dat[origin %like% 'LGA'] 
dat1 = dat[month %in% c(3,4,11,12)] 
dat1 = dat[origin %chin% c("JFK","LGA")] # %chin% is a faster %in% for (ch)aracter strings 
dat1 = dat[month!=1]</code>
                </pre>
              </div>
              <div class="grid grid-cols-1 xl:grid-cols-2 xl:gap-x-8 justify-start gap-y-4 mt-8">
                <div class="xl:col-span-2">
                  <h2 class="text-gray-600 text-lg font-semibold">Subset columns</h2>
                </div>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-stata">keep month day carrier 



keep year-arr_delay
keep *_delay 

ds, has(type int) 
keep `r(varlist)'

drop origin dest 


ds, has(type string) 
drop `r(varlist)'</code>
                </pre>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-r">dat1 = dat[, .(month, day, carrier)] 
dat1 = dat[, list(month, day, carrier)] # same as above 
dat1 = dat[, c('month', 'day', 'carrier')] # ditto 

dat1 = dat[, year:arr_delay] 
dat1 = dat[, .SD, .SDcols=patterns('*_delay')] 

# Matches the two lines on the left: 
dat1 = dat[, .SD, .SDcols=is.integer] 

dat1 = dat[, -c('origin', 'dest')]
dat1 = dat[, c('origin', 'dest') := NULL] # same effect as above, but in-place 

# Matches the two lines on the left:
dat1 = dat[, .SD, .SDcols=!is.character]</code>
                </pre>
              </div>
              <div class="grid grid-cols-1 xl:grid-cols-2 xl:gap-x-8 justify-start gap-y-4 mt-8">
                <div class="xl:col-span-2">
                  <h2 class="text-gray-600 text-lg font-semibold">Subset rows and columns</h2>
                </div>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-stata">keep if origin == "LGA"
keep month day carrier</code>
                </pre>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-r"># Matches the two lines on the left:
dat1 = dat[origin=="LGA", .(month, day, carrier)]</code>
                </pre>
              </div>
              <div class="grid grid-cols-1 xl:grid-cols-2 xl:gap-x-8 justify-start gap-y-4 mt-8">
                <div class="xl:col-span-2">
                  <h2 class="text-gray-600 text-lg font-semibold">Drop duplicates</h2>
                </div>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-stata">duplicates drop
duplicates drop month day carrier, force
</code>
                </pre>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-r">dat1 = unique(dat) 
dat1 = unique(dat, by = c('month', 'day', 'carrier'))</code>
                </pre>
              </div>
              <div class="grid grid-cols-1 xl:grid-cols-2 xl:gap-x-8 justify-start gap-y-4 mt-8">
                <div class="xl:col-span-2">
                  <h2 class="text-gray-600 text-lg font-semibold">Drop missing</h2>
                </div>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-stata">keep if !missing(dest)
* Requires: ssc inst missings
missings dropvars, force 
missings air_time dest, force 
</code>
                </pre>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-r">dat1 = dat[!is.na(dest)]

dat1 = na.omit(dat) 
dat1 = na.omit(dat, c('air_time', 'dest')) 
dat1 = dat[!is.na(air_time) &amp; !is.na(dest)] # Same as above</code>
                </pre>
              </div>
            </div>
          </div>
          <div id="modify">
            <div class="w-full max-w-5xl mx-auto py-12">
              <div class="flex flex-row">
                <h2 class="inline-block font-bold text-2xl text-[#315450]">Modify</h2>
              </div>
              <div class="flex flex-row prose mt-6 text-normal md:text-lg xl:text-xl"><p>Note: In R, any missing (i.e. "NA") values will propagate during aggregating functions. If you have NA values in your real-life dataset — we don't in this example dataset — you probably want to add "na.rm=TRUE" to remove these on the fly. E.g. "mean(var1, na.rm=TRUE)" or "lapply(.SD, mean, na.rm=TRUE)".</p></div>
              <div class="grid grid-cols-1 xl:grid-cols-2 xl:gap-x-8 justify-start gap-y-4 mt-8">
                <div class="xl:col-span-2">
                  <h2 class="text-gray-600 text-lg font-semibold">Create new variables</h2>
                </div>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-stata">gen dist_sq = distance^2 
gen tot_delay = dep_delay + arr_delay 
gen first_letter = substr(origin, 1,1) 
gen flight_path = origin + '_' + dest 

* These next operations don't have a great Stata 
* equivalent, although you could implement a loop</code>
                </pre>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-r">dat[, dist_sq := distance^2] 
dat[, tot_delay := dep_delay + arr_delay] 
dat[, first_letter := substr(origin,1,1)] 
dat[, flight_path := paste(origin, dest, sep='_')] 

# Multiple variables can be created at the same time 
dat[, c('dist_sq', 'dist_cu') := .(distance^2, distance^3)] 
dat[, ':=' (dist_sq=distance^2, dist_cu=distance^3)] # "functional" equivalent 

# We can also chain back-to-back dat[...][...] 
# (this holds for any data.table operation) 
dat[, dist_sq := distance^2][, dist_cu := distance*dist_sq)]</code>
                </pre>
              </div>
              <div class="grid grid-cols-1 xl:grid-cols-2 xl:gap-x-8 justify-start gap-y-4 mt-8">
                <div class="xl:col-span-2">
                  <h2 class="text-gray-600 text-lg font-semibold">Create new variables within groups</h2>
                </div>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-stata">bysort origin: egen mean_dep_delay = mean(dep_delay) 
bysort origin dest: egen mean_dep_delay2 = mean(dep_delay) 

* Multiple grouped variables (manual demean example) 
foreach x of varlist dep_delay arr_delay air_time {
    egen mean_`x'=mean(`x'), by(origin) 
    gen `x'_dm = `x` - mean_`x' 
    drop mean* 
}

* Some short-cut symbols 
bysort carrier: g rows_per_carrier = _N 
bysort carrier: g index_within_carrier = _n 
egen origin_index = group(origin)

* Refer to other rows (uses generic data set)
sort group time
by group: gen growth = X/X[_n-1]
by group: gen growth_since_first = X/X[1]</code>
                </pre>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-r">dat[, mean_dep_delay := mean(dep_delay), by=origin] 
dat[, mean_dep_delay2 := mean(dep_delay), by=.(origin, dest)] 

# Multiple grouped variables (manual demean example) 
dmcols = c('dep_delay', 'arr_delay', 'air_time') 
dat[,
    paste0(dmcols,'_dm') := lapply(.SD, \(x) x-mean(x)),  # before R 4.1 you'll need function(x) instead of the \(x) shorthand
    .SDcols = dmcols,
    by = origin] 

# Some short-cut symbols 
dat[, rows_per_carrier := .N, by = carrier] 
dat[, index_within_carrier := .I, by = carrier] 
dat[, origin_index := .GRP, by = origin]

# Refer to other rows (uses generic data set)
setorder(dat, group, time)
dat[, growth := X/shift(X, 1), by = group]
dat[, growth_since_first := X/first(X), by = group]</code>
                </pre>
              </div>
              <div class="grid grid-cols-1 xl:grid-cols-2 xl:gap-x-8 justify-start gap-y-4 mt-8">
                <div class="xl:col-span-2">
                  <h2 class="text-gray-600 text-lg font-semibold">Modify existing variables</h2>
                </div>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-stata">replace tot_delay = dep_delay + arr_delay 

* Conditional modification 
replace distance = distance + 1 if month==9
replace distance = 0 in 1</code>
                </pre>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-r">dat[, tot_delay := dep_delay + arr_delay] 

# Conditional modification 
dat[month==9, distance := distance + 1]
dat[1, distance := 0]

# Modify multiple variables at once with the same function
cols = c('origin','dest')
dat[, (cols) := lapply(.SD, \(x) paste(x,'Airport')), .SDcols = cols] # before R 4.1 you need function(x) instead of the \(x) shorthand</code>
                </pre>
              </div>
              <div class="grid grid-cols-1 xl:grid-cols-2 xl:gap-x-8 justify-start gap-y-4 mt-8">
                <div class="xl:col-span-2">
                  <h2 class="text-gray-600 text-lg font-semibold">Using Booleans &amp; control-flow</h2>
                </div>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-stata">gen long_flight = air_time&gt;500 &amp; !missing(air_time) 

gen flight_length = "Long" if air_time&gt;500 &amp; !missing(air_time)
replace flight_length = "Short" if missing(flight_length) &amp; !missing(air_time) 


gen flight_length2 = "Long" if !missing(air_time) 
replace flight_length2 = "Med" if air_time&lt;=500  
replace flight_length2 = "Short" if air_time&lt;=120</code>
                </pre>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-r">dat[, long_flight := air_time&gt;500] 

dat[, flight_length := fifelse(air_time&gt;500, 'Long', 'Short')] 
# fifelse is like base-R ifelse, but (f)aster! 

# for nested ifelse, easier to use fcase 
dat[, flight_length2 := fcase(air_time&lt;=120, 'Short', 
                            air_time&lt;=500, 'Med', 
                            default = 'Long')]</code>
                </pre>
              </div>
              <div class="grid grid-cols-1 xl:grid-cols-2 xl:gap-x-8 justify-start gap-y-4 mt-8">
                <div class="xl:col-span-2">
                  <h2 class="text-gray-600 text-lg font-semibold">Row-wise calculations</h2>
                </div>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-stata">* Pre-packaged row calculations: 
egen tot_delay = rowtotal(*_delay)
egen any_delay = rowfirst(*_delay)

* Custom row calculations:
* ?</code>
                </pre>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-r"># Pre-packaged row calculations: 
dat[, tot_delay := rowSums(.SD), .SDcols = patterns('*_delay')]
dat[, any_delay := fcoalesce(.SD), .SDcols = patterns('*_delay')] 

# Custom row calculations: 
dat[, new_var := mapply(custom_func, var1, var2)] 
dat[, new_var := custom_func(var1, var2)), by=1:nrow(dat)] # Another option

</code>
                </pre>
              </div>
              <div class="grid grid-cols-1 xl:grid-cols-2 xl:gap-x-8 justify-start gap-y-4 mt-8">
                <div class="xl:col-span-2">
                  <h2 class="text-gray-600 text-lg font-semibold">Fill in Time Series/Panel Data</h2>
                </div>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-stata">* Carry forward the last-known observation
sort id time
by id: replace x = x[_n-1] if missing(x)
* Carry back the next-known observation
gsort id -time
by id: replace x = x[_n-1] if missing(x)</code>
                </pre>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-r"># Carry forward the last-known observation
setorder(dat, id, time)
dat[, x := nafill(x, type = 'locf'), by = id]
# Carry back the next-known observation
dat[, x := nafill(x, type = 'nocb'), by = id]</code>
                </pre>
              </div>
            </div>
          </div>
          <div id="collapse">
            <div class="w-full max-w-5xl mx-auto py-12">
              <div class="flex flex-row">
                <h2 class="inline-block font-bold text-2xl text-[#315450]">Collapse</h2>
              </div>
              <div class="flex flex-row prose mt-6 text-normal md:text-lg xl:text-xl">Unlike Stata, multiple datasets can exist in memory and R's collapse operations won't overwrite your original dataset. That means you don't need to wrap everything in preserve/restore. However, it also means that you'll need to (re)assign your collapsed data if you want to use it again later. E.g. "dat1 = dat[, mean(var1)]". Also remember our earlier note about aggregating functions on columns that have missing values: Use "na.rm=TRUE" to remove these on the fly. E.g. "dat[, mean(var1, na.rm=TRUE)]".</p></div>
              <div class="grid grid-cols-1 xl:grid-cols-2 xl:gap-x-8 justify-start gap-y-4 mt-8">
                <div class="xl:col-span-2">
                  <h2 class="text-gray-600 text-lg font-semibold">Collapse with no grouping</h2>
                </div>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-stata">* Reminder: You'll need to use preserve/restore
* if you want to retain the original dataset in 
* the examples that follow. 

collapse (mean) dep_delay 
collapse (mean) mean_ddel=dep_delay 

collapse (mean) mean_ddel=dep_delay mean_adel=arr_delay 



collapse (mean) *delay 

ds, has(type long)
collapse (mean) `r(varlist)'</code>
                </pre>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-r"># Reminder: You'll need to (re)assign the 
# collapsed dataset if you want to use it later,
# e.g. dat1 = dat[, mean(dep_delay)] 

dat[, mean(dep_delay)] # scalar 
dat[, .(mean_ddel=mean(dep_delay))] # data.table 

dat[, .(mean_ddel=mean(dep_delay), mean_adel=mean(arr_delay))]
dat[, lapply(.SD, mean), .SDcols=c('arr_delay','dep_delay')] # same 
dat[, lapply(.SD, mean), .SDcols=arr_delay:dep_delay] # ditto 

dat[, lapply(.SD, mean), .SDcols=patterns('delay')] 

 # Matches the two lines on the left
dat[, lapply(.SD, mean), .SDcols=is.numeric]</code>
                </pre>
              </div>
              <div class="grid grid-cols-1 xl:grid-cols-2 xl:gap-x-8 justify-start gap-y-4 mt-8">
                <div class="xl:col-span-2">
                  <h2 class="text-gray-600 text-lg font-semibold">Collapse by group</h2>
                </div>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-stata">* Reminder: You'll need to use preserve/restore
* if you want to retain the original dataset in 
* the examples that follow. 

collapse (mean) arr_delay, by(carrier) 
collapse (mean) mean_adel = arr_delay, by(carrier) 

collapse (mean) arr_delay, by(carrier month) 

collapse (min) min_d = distance (max) max_d = distance, by(origin) 

collapse (mean) *_delay, by(origin) 
collapse (mean) dep_delay arr_delay air_time distance, by(origin) 


egen unique_dest = tag(dest origin) 
collapse (sum) unique_dest, by(origin)</code>
                </pre>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-r"># Reminder: You'll need to (re)assign the 
# collapsed dataset if you want to use it later,
# e.g. dat1 = dat[, mean(dep_delay), by=origin] 

dat[, .(arr_delay = mean(arr_delay)), by=carrier] 
dat[, .(mean_adel = mean(arr_delay)), by=carrier] 

dat[, .(arr_delay = mean(arr_delay)), by=.(carrier, month)] 

dat[, .(min_d = min(distance), max_d = max(distance)), by=origin] 

dat[, lapply(.SD, mean), .SDcols=patterns('_delay'), by=origin] 
dat[, lapply(.SD, mean), .SDcols=c('dep_delay','arr_delay','air_time','distance'), by=origin] 
dat[, lapply(.SD, mean), .SDcols = c(4,5,9,10), by=origin] # same as above 

# Matches the final two lines on the left: 
dat[, .(unique_dest = uniqueN(dest)), by = origin] 

# Bonus: You can also do complicated (grouped)
# aggregations as part of a dcast (i.e. reshape 
# wide) call. E.g. Get the min, mean and max
# arrival and departure delays, by origin airport.
dcast(dat, origin~., fun=list(min,mean,max),
      value.var=c('arr_delay','dep_delay'))</code>
                </pre>
              </div>
              <div class="grid grid-cols-1 xl:grid-cols-2 xl:gap-x-8 justify-start gap-y-4 mt-8">
                <div class="xl:col-span-2">
                  <h2 class="text-gray-600 text-lg font-semibold">Count rows</h2>
                </div>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-stata">count
count if month==10</code>
                </pre>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-r">dat[, .N] # Or: nrow(dat) 
dat[month==10, .N] # Or: nrow(dat[month==10])</code>
                </pre>
              </div>
            </div>
          </div>
          <div id="reshape">
            <div class="w-full max-w-5xl mx-auto py-12">
              <div class="flex flex-row">
                <h2 class="inline-block font-bold text-2xl text-[#315450]">Reshape</h2>
              </div>
              <div class="grid grid-cols-1 xl:grid-cols-2 xl:gap-x-8 justify-start gap-y-4 mt-8">
                <div class="xl:col-span-2">
                  <h2 class="text-gray-600 text-lg font-semibold">Reshape long</h2>
                </div>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-stata">* Prepare to reshape long (this dataset only):
gen id = _n 
rename (dep_delay arr_delay) (delay_dep delay_arr)

reshape long delay_, i(id) j(delay_type) s</code>
                </pre>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-r"># Prepare to reshape long (this dataset only):
dat[, id := .I] 

dat1 = melt(dat, measure.vars = c('arr_delay','dep_delay'))
# note id.vars would normally be specified too, but here we're treating each row as its own ID</code>
                </pre>
              </div>
              <div class="grid grid-cols-1 xl:grid-cols-2 xl:gap-x-8 justify-start gap-y-4 mt-8">
                <div class="xl:col-span-2">
                  <h2 class="text-gray-600 text-lg font-semibold">Reshape wide</h2>
                </div>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-stata">* This starts with the reshaped-long data from above
reshape wide delay_, (id) j(delay_type) s</code>
                </pre>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-r"># This starts with the reshaped-long data from above
dat2 = dcast(dat1, id ~ variable)
# (this drops all variables except id &amp; *_delay, 
# but we could preserve them with id+origin+dest+etc. instead of just id)</code>
                </pre>
              </div>
            </div>
          </div>
          <div id="merge">
            <div class="w-full max-w-5xl mx-auto py-12">
              <div class="flex flex-row">
                <h2 class="inline-block font-bold text-2xl text-[#315450]">Merge</h2>
              </div>
              <div class="grid grid-cols-1 xl:grid-cols-2 xl:gap-x-8 justify-start gap-y-4 mt-8">
                <div class="xl:col-span-2">
                  <h2 class="text-gray-600 text-lg font-semibold">Import secondary (airport) dataset</h2>
                </div>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-stata">import delimited using "https://vincentarelbundock.github.io/Rdatasets/csv/nycflights13/airports.csv", clear
save dat2.dta, replace
import delimited using "https://raw.githubusercontent.com/Rdatatable/data.table/master/vignettes/flights14.csv", clear</code>
                </pre>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-r">dat2 = fread("https://vincentarelbundock.github.io/Rdatasets/csv/nycflights13/airports.csv")</code>
                </pre>
              </div>
              <div class="grid grid-cols-1 xl:grid-cols-2 xl:gap-x-8 justify-start gap-y-4 mt-8">
                <div class="xl:col-span-2">
                  <h2 class="text-gray-600 text-lg font-semibold">Various Merges</h2>
                </div>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-stata">rename dest faa
* Only keep matches (inner join)
merge m:1 faa using dat2.dta, keep(3) nogen
* Keep all observations (full join)
merge m:1 faa using dat2.dta, nogen
* Keep matches and "master" non-matches (left join)
merge m:1 faa using dat2.dta, keep(1 3) nogen
* Keep matches and "using" non-matches (right join)
merge m:1 faa using dat2.dta, keep(2 3) nogen

merge m:1 faa using dat2.dta, keepusing(lat lon)












* Keep only non-matches (anti-join)
merge m:1 faa using dat2.dta, keep(1 2) nogen</code>
                </pre>
                <pre class="bg-white border-2 rounded-lg shadow-lg flex flex-col justify-start px-4 py-4">
                  <code class="language-r">setnames(dat, 'dest', 'faa')
# Only keep matches (inner join)
dat_merged = merge(dat, dat2, by='dest')
# Keep all observations (full join)
dat_merged = merge(dat, dat2, by='dest', all = TRUE)
# Keep matches and "master" non-matches (left join)
dat_merged = merge(dat, dat2, by='dest', all.x = TRUE)
# Keep matches and "using" non-matches (right join)
dat_merged = merge(dat, dat2, by='dest', all.y = TRUE)

dat_merged = merge(dat, dat2[, .(dest, lat, lon)], by='dest', all = TRUE)

# Alternate merging approaches
# Skip the setnames() and just merge with different variable names
dat_merged = merge(dat, dat2, by.x='dest', by.y='faa') 

# If using keys, don't need 'by'/'on' (and faster) 
setkey(dat, dest); setkey(dat2, dest) 
dat_merged = merge(dat, dat2)

# Alternate, more data-tably syntax
# That is also faster for some applications
dat_merged = dat[dat2, on='dest']
# Keep only non-matches (anti-join)
dat_merged = dat[!dat2, on='dest']</code>
                </pre>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>