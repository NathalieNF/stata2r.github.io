<template><h2 id="introduction-to-data-table" tabindex="-1"><a class="header-anchor" href="#introduction-to-data-table" aria-hidden="true">#</a> Introduction to data.table</h2>
<p>The <a href="https://rdatatable.gitlab.io/data.table" target="_blank" rel="noopener noreferrer"><strong>data.table</strong><ExternalLinkIcon/></a> package centers
around <em>data.tables</em>, which are highly efficient data frames that can be
manipulated using the package's concise syntax. For example, say we have a
data.table called <code>dat</code> (you can call it whatever you want). Then we can
manipulate it by putting arguments into its square brackets, i.e. <code>dat[]</code>. The
three main components of a <strong>data.table</strong> operation are <code>i</code>, <code>j</code>, and <code>by</code>,
which go in the order <strong><code>dat[i, j, by]</code></strong>. Note you don't have to specify the
latter two if you're not currently using them.</p>
<ul>
<li><strong><code>i</code></strong>, the first component, selects the rows of the data.table that you'll be working with, like how in Stata the <code>if</code> or <code>in</code> command options let you refer to certain rows.</li>
<li><strong><code>j</code></strong>, the second component, both selects and operates on the columns of the data.table, like how in Stata the <code>keep</code> or <code>drop</code> commands select specific columns of your data, or how <code>generate</code> or <code>replace</code> create or modify columns in your data.</li>
<li><strong><code>by</code></strong>, the third component, gives the variable(s) designating groups that you'll be doing your calculations within, like how in Stata you can precede a command with <code>bysort</code>.</li>
</ul>
<p><strong>data.table</strong> uses these simple components very flexibly. The upshot is that
you can perform complicated operations in a single line of concise <strong>data.table</strong>
code, which may have required multiple commands in other languages or libraries
to accomplish. But even if you aren't doing anything fancy, <strong>data.table</strong> has
you covered with a stable set of functions that can be deployed on virtually
any data wrangling task.</p>
<p>Like Stata, <strong>data.table</strong> also provides some special shortcut symbols for
common operations. For example, <code>_N</code> in Stata is equivalent to <code>.N</code> in
<strong>data.table</strong>, while <code>.(x1, x2)</code> is short for <code>list(x1, x2)</code>. We'll see more
examples in cheatsheat that follows. But we do want to quickly highlight one
special symbol in particular: <code>.SD</code> refers to the (S)ubset of (D)ata you're
working with. This can be used to do complex within-group calculations when you
have by specified, but more generally it's a way to perform operations on lots
of columns with one line of code. By default, <code>.SD</code> refers to all columns in the
dataset (excepting those in <code>by</code>). But you can specify the columns you want with
the <code>.SDcols</code> argument. Again, we'll see a bunch of examples below.</p>
<p>Finally, <strong>data.table</strong> is extremely fast. It has long set the standard for
in-memory data wrangling <a href="https://h2oai.github.io/db-benchmark" target="_blank" rel="noopener noreferrer">benchmarks<ExternalLinkIcon/></a>
across a variety of libraries and languages. You will likely see an order(s) of
magnitude performance difference as you compare the code chunks below. As a
bonus for Stata users, who are used to operations changing a single dataset in
memory, many <strong>data.table</strong> operations can be done <em>in-place</em>. This means that
you don't have to (re)assign the result to a new <strong>data.table</strong>. In-place
modifications are also very efficient, since they will only affect the parts
you're actually changing, without wasting memory and time on the parts that
aren't being changed. Any time in the below cheat sheet you see a function with
the word <code>set</code> in it, or the <code>:=</code> operator, that's an in-place operation.</p>
<p>Before continuing, make sure that you have installed <code>data.table</code>. You only
have to do this once (or as often as you want to update the package).</p>
<div class="code--container grid-cols-1">
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)"># Install from CRAN (recommended) </span></span>
<span class="line"><span style="color: var(--shiki-token-function)">install.packages</span><span style="color: var(--shiki-color-text)">(data.table)</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># Install the development version from GitHub (advanced) </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># Requires Rtools and the remotes package </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># remotes::install_github(&#39;Rdatatable/data.table&#39;)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div>
</div>
<p>Once <code>data.table</code> is installed, don't forget to load it whenever you want to
use it. Unlike Stata, you have to re-load a package every time you start a new R
session.</p>
<div class="code--container grid-cols-1">
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)"># Load data.table into our current R session</span></span>
<span class="line"><span style="color: var(--shiki-token-function)">library</span><span style="color: var(--shiki-color-text)">(data.table)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div>
</div>
<h2 id="data-i-o" tabindex="-1"><a class="header-anchor" href="#data-i-o" aria-hidden="true">#</a> Data I/O</h2>
<p>Like Stata's &quot;.dta&quot; format, R has its own native &quot;.rds&quot; binary file storage type. (See also the <a href = "http://www.fstpackage.org/">fst</a> package.) However, we generally recommend that users avoid native—especially proprietary—data types since they hamper interoperability and reproducibility. We'll hence concentrate on common open-source file types below. We'll make an exception for .dta given our target audience, but we still recommend avoiding it if possible.</p>
<h3 id="read-and-write-csv" tabindex="-1"><a class="header-anchor" href="#read-and-write-csv" aria-hidden="true">#</a> Read and write .csv</h3>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-color-text)">import delimited using </span><span style="color: var(--shiki-token-string-expression)">&quot;https://raw.githubusercontent.com/Rdatatable/data.table/master/vignettes/flights14.csv&quot;</span><span style="color: var(--shiki-color-text)">, </span><span style="color: var(--shiki-token-keyword)">clear</span><span style="color: var(--shiki-color-text)"> </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">export delimited using </span><span style="color: var(--shiki-token-string-expression)">&quot;flightdata.csv&quot;</span><span style="color: var(--shiki-color-text)">, replace</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-color-text)">dat </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">fread(</span><span style="color: var(--shiki-token-string-expression)">&#39;https://raw.githubusercontent.com/Rdatatable/data.table/master/vignettes/flights14.csv&#39;</span><span style="color: var(--shiki-token-function)">)</span></span>
<span class="line"><span style="color: var(--shiki-token-function)">fwrite(</span><span style="color: var(--shiki-token-punctuation)">dat, </span><span style="color: var(--shiki-token-string-expression)">&#39;flightdata.csv&#39;</span><span style="color: var(--shiki-token-function)">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div>
</div>
<h3 id="read-and-write-parquet" tabindex="-1"><a class="header-anchor" href="#read-and-write-parquet" aria-hidden="true">#</a> Read and write .parquet</h3>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">* Stata currently has limited support for parquet files </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* (and Linux/Unix only). </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* See: https://github.com/mcaceresb/stata-parquet</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)"># These commands require the `arrow` package </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">pfiles </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">dir</span><span style="color: var(--shiki-color-text)">(pattern </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot;.parquet&quot;</span><span style="color: var(--shiki-color-text)">) </span></span>
<span class="line"><span style="color: var(--shiki-token-function)">rbindlist(lapply</span><span style="color: var(--shiki-token-punctuation)">(pfiles, arrow</span><span style="color: var(--shiki-token-keyword)">::</span><span style="color: var(--shiki-token-punctuation)">read_parquet</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">) </span></span>
<span class="line"><span style="color: var(--shiki-token-function)">rbindlist(lapply</span><span style="color: var(--shiki-token-punctuation)">(pfiles, arrow</span><span style="color: var(--shiki-token-keyword)">::</span><span style="color: var(--shiki-token-punctuation)">read_parquet, col_select</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-token-constant)">10</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div>
</div>
<h3 id="read-and-write-dta" tabindex="-1"><a class="header-anchor" href="#read-and-write-dta" aria-hidden="true">#</a> Read and write .dta</h3>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">* .dta is Stata&#39;s native (proprietary) filetype </span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">use</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot;filename.dta&quot;</span><span style="color: var(--shiki-color-text)">, </span><span style="color: var(--shiki-token-keyword)">clear</span><span style="color: var(--shiki-color-text)"> </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">save</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot;filename.dta&quot;</span><span style="color: var(--shiki-color-text)">, replace</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)"># These commands require the `haven` package </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> haven</span><span style="color: var(--shiki-token-keyword)">::</span><span style="color: var(--shiki-token-function)">read_dta(</span><span style="color: var(--shiki-token-string-expression)">&#39;filename.dta&#39;</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)"> </span></span>
<span class="line"><span style="color: var(--shiki-token-function)">setDT(</span><span style="color: var(--shiki-token-punctuation)">dat</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-comment)"># Or: dat = as.data.table(dat) </span></span>
<span class="line"><span style="color: var(--shiki-color-text)"> </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">haven</span><span style="color: var(--shiki-token-keyword)">::</span><span style="color: var(--shiki-token-function)">write_dta(</span><span style="color: var(--shiki-token-punctuation)">dat, </span><span style="color: var(--shiki-token-string-expression)">&#39;filename.dta&#39;</span><span style="color: var(--shiki-token-function)">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div>
</div>
<h2 id="order" tabindex="-1"><a class="header-anchor" href="#order" aria-hidden="true">#</a> Order</h2>
<h3 id="sort-rows" tabindex="-1"><a class="header-anchor" href="#sort-rows" aria-hidden="true">#</a> Sort rows</h3>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">sort</span><span style="color: var(--shiki-color-text)"> air_time </span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">sort</span><span style="color: var(--shiki-color-text)"> air_time dest </span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">gsort</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">-</span><span style="color: var(--shiki-color-text)">air_time</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-function)">setorder(</span><span style="color: var(--shiki-token-punctuation)">dat, air_time</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)"> </span></span>
<span class="line"><span style="color: var(--shiki-token-function)">setorder(</span><span style="color: var(--shiki-token-punctuation)">dat, air_time, dest</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)"> </span></span>
<span class="line"><span style="color: var(--shiki-token-function)">setorder(</span><span style="color: var(--shiki-token-punctuation)">dat, </span><span style="color: var(--shiki-token-keyword)">-</span><span style="color: var(--shiki-token-punctuation)">air_time</span><span style="color: var(--shiki-token-function)">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div>
</div>
<h3 id="sort-columns" tabindex="-1"><a class="header-anchor" href="#sort-columns" aria-hidden="true">#</a> Sort columns</h3>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">order</span><span style="color: var(--shiki-color-text)"> month day</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-function)">setcolorder(</span><span style="color: var(--shiki-token-punctuation)">dat, </span><span style="color: var(--shiki-token-function)">c</span><span style="color: var(--shiki-token-punctuation)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;month&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-token-string-expression)">&#39;day&#39;</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div>
</div>
<h3 id="rename-columns" tabindex="-1"><a class="header-anchor" href="#rename-columns" aria-hidden="true">#</a> Rename columns</h3>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">* rename (old) (new) </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">rename</span><span style="color: var(--shiki-color-text)"> arr_delay arrival_delay </span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">rename</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">(</span><span style="color: var(--shiki-color-text)">carrier origin</span><span style="color: var(--shiki-token-keyword)">)</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">(</span><span style="color: var(--shiki-color-text)">carrier_code origin_code</span><span style="color: var(--shiki-token-keyword)">)</span><span style="color: var(--shiki-color-text)"> </span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">rename</span><span style="color: var(--shiki-color-text)"> arr_</span><span style="color: var(--shiki-token-keyword)">*</span><span style="color: var(--shiki-color-text)"> arrival_</span><span style="color: var(--shiki-token-keyword)">*</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)"># setnames(dat, old = ..., new = ...) </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-function)">setnames(</span><span style="color: var(--shiki-token-punctuation)">dat, </span><span style="color: var(--shiki-token-string-expression)">&#39;arr_delay&#39;</span><span style="color: var(--shiki-token-punctuation)">, </span><span style="color: var(--shiki-token-string-expression)">&#39;arrival_delay&#39;</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)"> </span></span>
<span class="line"><span style="color: var(--shiki-token-function)">setnames(</span><span style="color: var(--shiki-token-punctuation)">dat, </span><span style="color: var(--shiki-token-function)">c</span><span style="color: var(--shiki-token-punctuation)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;carrier&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-token-string-expression)">&#39;origin&#39;</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">, </span><span style="color: var(--shiki-token-function)">c</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;carrier_code&#39;</span><span style="color: var(--shiki-color-text)">,</span><span style="color: var(--shiki-token-string-expression)">&#39;origin_code&#39;</span><span style="color: var(--shiki-color-text)">)) </span></span>
<span class="line"><span style="color: var(--shiki-token-function)">setnames(</span><span style="color: var(--shiki-token-punctuation)">dat, </span><span style="color: var(--shiki-token-function)">gsub</span><span style="color: var(--shiki-token-punctuation)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;arr_&#39;</span><span style="color: var(--shiki-token-punctuation)">, </span><span style="color: var(--shiki-token-string-expression)">&#39;arrival_&#39;</span><span style="color: var(--shiki-token-punctuation)">, </span><span style="color: var(--shiki-token-function)">names</span><span style="color: var(--shiki-token-punctuation)">(dat</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">))</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div>
</div>
<h2 id="subset" tabindex="-1"><a class="header-anchor" href="#subset" aria-hidden="true">#</a> Subset</h2>
<p>While it takes some doing in Stata to work with multiple data sets at once (and most people do not use Stata this way, and it doesn't work in old versions), using multiple datasets at once is standard in R, and <strong>subsetting operations won't overwrite your original dataset</strong>. That means you don't need to wrap everything in <code>preserve/restore</code>. However, it also means that you'll need to (re)assign your subsetted data if you want to use it again later. E.g. <code>dat1 = dat[origin=='LGA']</code>.</p>
<h3 id="subset-rows" tabindex="-1"><a class="header-anchor" href="#subset-rows" aria-hidden="true">#</a> Subset rows</h3>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">* Reminder: You&#39;ll need to use preserve/restore</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* if you want to retain the original dataset in </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* the examples that follow. </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">keep</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">in</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-token-keyword)">/</span><span style="color: var(--shiki-token-constant)">200</span><span style="color: var(--shiki-color-text)"> </span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">keep</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> day </span><span style="color: var(--shiki-token-keyword)">&gt;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">5</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">&amp;</span><span style="color: var(--shiki-color-text)"> day </span><span style="color: var(--shiki-token-keyword)">&lt;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">10</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">keep</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">inrange</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">day</span><span style="color: var(--shiki-color-text)">,</span><span style="color: var(--shiki-token-constant)">5</span><span style="color: var(--shiki-color-text)">,</span><span style="color: var(--shiki-token-constant)">10</span><span style="color: var(--shiki-color-text)">)</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">keep</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> origin </span><span style="color: var(--shiki-token-keyword)">==</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot;LGA&quot;</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">keep</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">regex</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">origin</span><span style="color: var(--shiki-color-text)">,</span><span style="color: var(--shiki-token-string-expression)">&quot;LGA&quot;</span><span style="color: var(--shiki-color-text)">) </span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">keep</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">inlist</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">month</span><span style="color: var(--shiki-color-text)">,</span><span style="color: var(--shiki-token-constant)">3</span><span style="color: var(--shiki-color-text)">,</span><span style="color: var(--shiki-token-constant)">4</span><span style="color: var(--shiki-color-text)">,</span><span style="color: var(--shiki-token-constant)">11</span><span style="color: var(--shiki-color-text)">,</span><span style="color: var(--shiki-token-constant)">12</span><span style="color: var(--shiki-color-text)">) </span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">keep</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">inlist</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">origin</span><span style="color: var(--shiki-color-text)">,</span><span style="color: var(--shiki-token-string-expression)">&quot;JFK&quot;</span><span style="color: var(--shiki-color-text)">,</span><span style="color: var(--shiki-token-string-expression)">&quot;LGA&quot;</span><span style="color: var(--shiki-color-text)">) </span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">drop</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> month </span><span style="color: var(--shiki-token-keyword)">==</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">1</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)"># Reminder: You&#39;ll need to (re)assign the </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># collapsed dataset if you want to use it later,</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># e.g. dat1 = dat[1:200] </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[</span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-token-constant)">200</span><span style="color: var(--shiki-color-text)">] </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[day </span><span style="color: var(--shiki-token-keyword)">&gt;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">5</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">&amp;</span><span style="color: var(--shiki-color-text)"> day </span><span style="color: var(--shiki-token-keyword)">&lt;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">10</span><span style="color: var(--shiki-color-text)">] </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[</span><span style="color: var(--shiki-token-function)">between(</span><span style="color: var(--shiki-token-punctuation)">day,</span><span style="color: var(--shiki-token-constant)">5</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-token-constant)">10</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">] </span><span style="color: var(--shiki-token-comment)"># Or: dat[day %in% 5:10] </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[origin</span><span style="color: var(--shiki-token-keyword)">==</span><span style="color: var(--shiki-token-string-expression)">&#39;LGA&#39;</span><span style="color: var(--shiki-color-text)">]</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[origin </span><span style="color: var(--shiki-token-keyword)">%like%</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;LGA&#39;</span><span style="color: var(--shiki-color-text)">] </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[month </span><span style="color: var(--shiki-token-keyword)">%in%</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">c</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-constant)">3</span><span style="color: var(--shiki-color-text)">,</span><span style="color: var(--shiki-token-constant)">4</span><span style="color: var(--shiki-color-text)">,</span><span style="color: var(--shiki-token-constant)">11</span><span style="color: var(--shiki-color-text)">,</span><span style="color: var(--shiki-token-constant)">12</span><span style="color: var(--shiki-color-text)">)] </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[origin </span><span style="color: var(--shiki-token-keyword)">%chin%</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">c</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&quot;JFK&quot;</span><span style="color: var(--shiki-color-text)">,</span><span style="color: var(--shiki-token-string-expression)">&quot;LGA&quot;</span><span style="color: var(--shiki-color-text)">)] </span><span style="color: var(--shiki-token-comment)"># %chin% is a faster %in% for (ch)aracter strings </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[month</span><span style="color: var(--shiki-token-keyword)">!=</span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></div>
</div>
<h3 id="subset-columns" tabindex="-1"><a class="header-anchor" href="#subset-columns" aria-hidden="true">#</a> Subset columns</h3>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">* Reminder: You&#39;ll need to use preserve/restore</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* if you want to retain the original dataset in </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* the examples that follow. </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">keep</span><span style="color: var(--shiki-color-text)"> month day carrier </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">keep</span><span style="color: var(--shiki-color-text)"> year</span><span style="color: var(--shiki-token-keyword)">-</span><span style="color: var(--shiki-color-text)">arr_delay</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">keep</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">*</span><span style="color: var(--shiki-color-text)">_delay </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">drop</span><span style="color: var(--shiki-color-text)"> origin dest </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">ds</span><span style="color: var(--shiki-color-text)">, </span><span style="color: var(--shiki-token-function)">has</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">type</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-parameter)">string</span><span style="color: var(--shiki-color-text)">) </span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">drop</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-color-text)">`</span><span style="color: var(--shiki-token-function)">r</span><span style="color: var(--shiki-token-comment)">(varlist)</span><span style="color: var(--shiki-color-text)">&#39;</span><span style="color: var(--shiki-color-text)"> </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">ds</span><span style="color: var(--shiki-color-text)">, </span><span style="color: var(--shiki-token-function)">has</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">type</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-parameter)">int</span><span style="color: var(--shiki-color-text)">) </span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">keep</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-color-text)">`</span><span style="color: var(--shiki-token-function)">r</span><span style="color: var(--shiki-token-comment)">(varlist)</span><span style="color: var(--shiki-color-text)">&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)"># Reminder: You&#39;ll need to (re)assign the </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># collapsed dataset if you want to use it later,</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># e.g. dat1 = dat[, .(month, day, carrier)] </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, </span><span style="color: var(--shiki-token-function)">.(</span><span style="color: var(--shiki-token-punctuation)">month, day, carrier</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">] </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, </span><span style="color: var(--shiki-token-keyword)">list</span><span style="color: var(--shiki-color-text)">(month, day, carrier)] </span><span style="color: var(--shiki-token-comment)"># same as above </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, </span><span style="color: var(--shiki-token-function)">c</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;month&#39;</span><span style="color: var(--shiki-color-text)">, </span><span style="color: var(--shiki-token-string-expression)">&#39;day&#39;</span><span style="color: var(--shiki-color-text)">, </span><span style="color: var(--shiki-token-string-expression)">&#39;carrier&#39;</span><span style="color: var(--shiki-color-text)">)] </span><span style="color: var(--shiki-token-comment)"># ditto </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, year</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)">arr_delay] </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, .SD, .SDcols</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-function)">patterns(</span><span style="color: var(--shiki-token-string-expression)">&#39;*_delay&#39;</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">] </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, </span><span style="color: var(--shiki-token-keyword)">-</span><span style="color: var(--shiki-token-function)">c</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;origin&#39;</span><span style="color: var(--shiki-color-text)">, </span><span style="color: var(--shiki-token-string-expression)">&#39;dest&#39;</span><span style="color: var(--shiki-color-text)">)]</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, </span><span style="color: var(--shiki-token-function)">c</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;origin&#39;</span><span style="color: var(--shiki-color-text)">, </span><span style="color: var(--shiki-token-string-expression)">&#39;dest&#39;</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">NULL</span><span style="color: var(--shiki-color-text)">] </span><span style="color: var(--shiki-token-comment)"># same, but in-place </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># Matches the two lines on the left:</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, .SD, .SDcols</span><span style="color: var(--shiki-token-keyword)">=!</span><span style="color: var(--shiki-color-text)">is.character] </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># Matches the two lines on the left: </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, .SD, .SDcols</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)">is.integer]</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></div>
</div>
<h3 id="subset-rows-and-columns" tabindex="-1"><a class="header-anchor" href="#subset-rows-and-columns" aria-hidden="true">#</a> Subset rows and columns</h3>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">* Reminder: You&#39;ll need to use preserve/restore</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* if you want to retain the original dataset in </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* the examples that follow. </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">keep</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> origin </span><span style="color: var(--shiki-token-keyword)">==</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot;LGA&quot;</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">keep</span><span style="color: var(--shiki-color-text)"> month day carrier</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)"># Reminder: You&#39;ll need to (re)assign the </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># collapsed dataset if you want to use it later,</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># e.g. dat1 = dat[origin==&quot;LGA&quot;, .(month, day, carrier)] </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># Matches the two lines on the left:</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[origin</span><span style="color: var(--shiki-token-keyword)">==</span><span style="color: var(--shiki-token-string-expression)">&quot;LGA&quot;</span><span style="color: var(--shiki-color-text)">, </span><span style="color: var(--shiki-token-function)">.(</span><span style="color: var(--shiki-token-punctuation)">month, day, carrier</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div>
</div>
<h3 id="drop-duplicates" tabindex="-1"><a class="header-anchor" href="#drop-duplicates" aria-hidden="true">#</a> Drop duplicates</h3>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">* Reminder: You&#39;ll need to use preserve/restore</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* if you want to retain the original dataset in </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* the examples that follow. </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">duplicates</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">drop</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">duplicates</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">drop</span><span style="color: var(--shiki-color-text)"> month day carrier, force</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)"># Reminder: You&#39;ll need to (re)assign the </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># collapsed dataset if you want to use it later,</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># e.g. dat1 = unique(dat) </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-function)">unique</span><span style="color: var(--shiki-color-text)">(dat) </span></span>
<span class="line"><span style="color: var(--shiki-token-function)">unique</span><span style="color: var(--shiki-color-text)">(dat, by </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">c</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;month&#39;</span><span style="color: var(--shiki-color-text)">, </span><span style="color: var(--shiki-token-string-expression)">&#39;day&#39;</span><span style="color: var(--shiki-color-text)">, </span><span style="color: var(--shiki-token-string-expression)">&#39;carrier&#39;</span><span style="color: var(--shiki-color-text)">))</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div>
</div>
<h3 id="drop-missing" tabindex="-1"><a class="header-anchor" href="#drop-missing" aria-hidden="true">#</a> Drop missing</h3>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">* Reminder: You&#39;ll need to use preserve/restore</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* if you want to retain the original dataset in </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* the examples that follow. </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">keep</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">!</span><span style="color: var(--shiki-token-function)">missing</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">dest</span><span style="color: var(--shiki-color-text)">)</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* Requires: ssc inst missings</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">missings dropvars, force </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">missings air_time dest, force </span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)"># Reminder: You&#39;ll need to (re)assign the </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># collapsed dataset if you want to use it later,</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># e.g. dat = dat[!is.na(dest)] </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[</span><span style="color: var(--shiki-token-keyword)">!</span><span style="color: var(--shiki-token-function)">is.na</span><span style="color: var(--shiki-color-text)">(dest)]</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-function)">na.omit</span><span style="color: var(--shiki-color-text)">(dat) </span></span>
<span class="line"><span style="color: var(--shiki-token-function)">na.omit</span><span style="color: var(--shiki-color-text)">(dat, cols </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">c</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;air_time&#39;</span><span style="color: var(--shiki-color-text)">, </span><span style="color: var(--shiki-token-string-expression)">&#39;dest&#39;</span><span style="color: var(--shiki-color-text)">)) </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[</span><span style="color: var(--shiki-token-keyword)">!</span><span style="color: var(--shiki-token-function)">is.na</span><span style="color: var(--shiki-color-text)">(air_time) </span><span style="color: var(--shiki-token-keyword)">&amp;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">!</span><span style="color: var(--shiki-token-function)">is.na</span><span style="color: var(--shiki-color-text)">(dest)] </span><span style="color: var(--shiki-token-comment)"># Same as above</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></div>
</div>
<h2 id="modify" tabindex="-1"><a class="header-anchor" href="#modify" aria-hidden="true">#</a> Modify</h2>
<p>In R, any missing (i.e. &quot;NA&quot;) values will propagate during aggregating functions. If you have NA values in your real-life dataset — we don't in this example dataset — you probably want to add &quot;na.rm=TRUE&quot; to remove these on the fly. E.g. &quot;mean(var1, na.rm=TRUE)&quot; or &quot;lapply(.SD, mean, na.rm=TRUE)&quot;.</p>
<h3 id="create-new-variables" tabindex="-1"><a class="header-anchor" href="#create-new-variables" aria-hidden="true">#</a> Create new variables</h3>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">gen</span><span style="color: var(--shiki-color-text)"> dist_sq </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> distance</span><span style="color: var(--shiki-token-keyword)">^</span><span style="color: var(--shiki-token-constant)">2</span><span style="color: var(--shiki-color-text)"> </span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">gen</span><span style="color: var(--shiki-color-text)"> tot_delay </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> dep_delay </span><span style="color: var(--shiki-token-keyword)">+</span><span style="color: var(--shiki-color-text)"> arr_delay </span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">gen</span><span style="color: var(--shiki-color-text)"> first_letter </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">substr</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">origin</span><span style="color: var(--shiki-color-text)">, </span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)">,</span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)">) </span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">gen</span><span style="color: var(--shiki-color-text)"> flight_path </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> origin </span><span style="color: var(--shiki-token-keyword)">+</span><span style="color: var(--shiki-color-text)"> &#39;_&#39; </span><span style="color: var(--shiki-token-keyword)">+</span><span style="color: var(--shiki-color-text)"> dest </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* These next operations don&#39;t have a great Stata </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* equivalent, although you could implement a loop.</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-color-text)">dat[, dist_sq </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> distance</span><span style="color: var(--shiki-token-keyword)">^</span><span style="color: var(--shiki-token-constant)">2</span><span style="color: var(--shiki-color-text)">] </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, tot_delay </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> dep_delay </span><span style="color: var(--shiki-token-keyword)">+</span><span style="color: var(--shiki-color-text)"> arr_delay] </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, first_letter </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">substr</span><span style="color: var(--shiki-color-text)">(origin,</span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)">,</span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)">)] </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, flight_path </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">paste</span><span style="color: var(--shiki-color-text)">(origin, dest, sep</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-string-expression)">&#39;_&#39;</span><span style="color: var(--shiki-color-text)">)] </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># Multiple variables can be created at once.</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># These next few lines all do the same thing.</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># Just pick your favourite. </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, </span><span style="color: var(--shiki-token-function)">c</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;dist_sq&#39;</span><span style="color: var(--shiki-color-text)">, </span><span style="color: var(--shiki-token-string-expression)">&#39;dist_cu&#39;</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">.(</span><span style="color: var(--shiki-token-punctuation)">distance</span><span style="color: var(--shiki-token-keyword)">^</span><span style="color: var(--shiki-token-constant)">2</span><span style="color: var(--shiki-token-punctuation)">, distance</span><span style="color: var(--shiki-token-keyword)">^</span><span style="color: var(--shiki-token-constant)">3</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">] </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, </span><span style="color: var(--shiki-token-string-expression)">&#39;:=&#39;</span><span style="color: var(--shiki-color-text)"> (dist_sq</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)">distance</span><span style="color: var(--shiki-token-keyword)">^</span><span style="color: var(--shiki-token-constant)">2</span><span style="color: var(--shiki-color-text)">, dist_cu</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)">distance</span><span style="color: var(--shiki-token-keyword)">^</span><span style="color: var(--shiki-token-constant)">3</span><span style="color: var(--shiki-color-text)">)] </span><span style="color: var(--shiki-token-comment)"># &quot;functional&quot; equivalent </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, </span><span style="color: var(--shiki-token-function)">let(</span><span style="color: var(--shiki-token-punctuation)">dist_sq</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-punctuation)">distance</span><span style="color: var(--shiki-token-keyword)">^</span><span style="color: var(--shiki-token-constant)">2</span><span style="color: var(--shiki-token-punctuation)">, dist_cu</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-punctuation)">distance</span><span style="color: var(--shiki-token-keyword)">^</span><span style="color: var(--shiki-token-constant)">3</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">] </span><span style="color: var(--shiki-token-comment)"># dev version only</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># We can also chain back-to-back dat[...][...] </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># (this holds for any data.table operation) </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, dist_sq </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> distance</span><span style="color: var(--shiki-token-keyword)">^</span><span style="color: var(--shiki-token-constant)">2</span><span style="color: var(--shiki-color-text)">][</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    , dist_cu </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> distance</span><span style="color: var(--shiki-token-keyword)">*</span><span style="color: var(--shiki-color-text)">dist_sq]</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></div>
</div>
<h3 id="create-new-variables-within-groups" tabindex="-1"><a class="header-anchor" href="#create-new-variables-within-groups" aria-hidden="true">#</a> Create new variables within groups</h3>
<p><strong>Aside:</strong> In R, any missing (i.e. &quot;NA&quot;) values will propagate during aggregating functions. If you have <code>NA</code> values in your real-life dataset — we don't in this example dataset — you probably want to add <code>na.rm=TRUE</code> to remove these on the fly. E.g. <code>mean(var1, na.rm=TRUE)</code> or <code>lapply(.SD, mean, na.rm=TRUE)</code>.</p>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">bysort</span><span style="color: var(--shiki-color-text)"> origin</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">egen</span><span style="color: var(--shiki-color-text)"> mean_dep_delay </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">mean</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">dep_delay</span><span style="color: var(--shiki-color-text)">) </span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">bysort</span><span style="color: var(--shiki-color-text)"> origin dest</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">egen</span><span style="color: var(--shiki-color-text)"> mean_dep_delay2 </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">mean</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">dep_delay</span><span style="color: var(--shiki-color-text)">) </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* Multiple grouped variables (manual demean example) </span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">foreach</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">x</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">of varlist</span><span style="color: var(--shiki-color-text)"> dep_delay arr_delay air_time </span><span style="color: var(--shiki-token-keyword)">{</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">egen</span><span style="color: var(--shiki-color-text)"> mean_</span><span style="color: var(--shiki-color-text)">`</span><span style="color: var(--shiki-token-function)">x</span><span style="color: var(--shiki-color-text)">&#39;</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-function)">mean</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-color-text)">`</span><span style="color: var(--shiki-token-function)">x</span><span style="color: var(--shiki-color-text)">&#39;</span><span style="color: var(--shiki-color-text)">), </span><span style="color: var(--shiki-token-function)">by</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">origin</span><span style="color: var(--shiki-color-text)">) </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">gen</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-color-text)">`</span><span style="color: var(--shiki-token-function)">x</span><span style="color: var(--shiki-color-text)">&#39;</span><span style="color: var(--shiki-color-text)">_dm </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-color-text)">`</span><span style="color: var(--shiki-token-function)">x</span><span style="color: var(--shiki-color-text)">`</span><span style="color: var(--shiki-token-comment)"> - mean_`x</span><span style="color: var(--shiki-color-text)">&#39;</span><span style="color: var(--shiki-token-comment)"> </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">    drop mean* </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* Some short-cut symbols </span></span>
<span class="line"><span style="color: var(--shiki-token-function)">bysort</span><span style="color: var(--shiki-token-comment)"> carrier: g rows_per_carrier = _N </span></span>
<span class="line"><span style="color: var(--shiki-token-function)">bysort</span><span style="color: var(--shiki-token-comment)"> carrier: g index_within_carrier = _n </span></span>
<span class="line"><span style="color: var(--shiki-token-function)">egen</span><span style="color: var(--shiki-token-comment)"> origin_index = group(origin)</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* Refer to other rows (uses generic data set)</span></span>
<span class="line"><span style="color: var(--shiki-token-function)">sort</span><span style="color: var(--shiki-token-comment)"> group time</span></span>
<span class="line"><span style="color: var(--shiki-token-function)">by</span><span style="color: var(--shiki-token-comment)"> group: gen growth = X/X[_n-1]</span></span>
<span class="line"><span style="color: var(--shiki-token-function)">by</span><span style="color: var(--shiki-token-comment)"> group: gen growth_since_first = X/X[1]</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-color-text)">dat[, mean_dep_delay </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">mean</span><span style="color: var(--shiki-color-text)">(dep_delay), by</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)">origin] </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, mean_dep_delay2 </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">mean</span><span style="color: var(--shiki-color-text)">(dep_delay), by</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-function)">.(</span><span style="color: var(--shiki-token-punctuation)">origin, dest</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">] </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># Multiple grouped variables (manual demean example) </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dmcols </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">c</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;dep_delay&#39;</span><span style="color: var(--shiki-color-text)">, </span><span style="color: var(--shiki-token-string-expression)">&#39;arr_delay&#39;</span><span style="color: var(--shiki-color-text)">, </span><span style="color: var(--shiki-token-string-expression)">&#39;air_time&#39;</span><span style="color: var(--shiki-color-text)">) </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">paste0</span><span style="color: var(--shiki-color-text)">(dmcols,</span><span style="color: var(--shiki-token-string-expression)">&#39;_dm&#39;</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">lapply</span><span style="color: var(--shiki-color-text)">(.SD, \(x) x</span><span style="color: var(--shiki-token-keyword)">-</span><span style="color: var(--shiki-token-function)">mean</span><span style="color: var(--shiki-color-text)">(x)),  </span><span style="color: var(--shiki-token-comment)"># before R 4.1 you&#39;ll need function(x) instead of the \(x) shorthand</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    .SDcols </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> dmcols,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    by </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> origin] </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># Some short-cut symbols </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, rows_per_carrier </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> .N, by </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> carrier] </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, index_within_carrier </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> .I, by </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> carrier] </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, origin_index </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> .GRP, by </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> origin]</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># Refer to other rows (uses generic data set)</span></span>
<span class="line"><span style="color: var(--shiki-token-function)">setorder(</span><span style="color: var(--shiki-token-punctuation)">dat, group, time</span><span style="color: var(--shiki-token-function)">)</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, growth </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> X</span><span style="color: var(--shiki-token-keyword)">/</span><span style="color: var(--shiki-token-function)">shift(</span><span style="color: var(--shiki-token-punctuation)">X, </span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">, by </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> group]</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, growth_since_first </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> X</span><span style="color: var(--shiki-token-keyword)">/</span><span style="color: var(--shiki-token-function)">first(</span><span style="color: var(--shiki-token-punctuation)">X</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">, by </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> group]</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></div>
</div>
<h3 id="work-with-dates" tabindex="-1"><a class="header-anchor" href="#work-with-dates" aria-hidden="true">#</a> Work with dates</h3>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">* Give ourselves a date variable to work with</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">tostring</span><span style="color: var(--shiki-color-text)"> year month day, replace</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">gen</span><span style="color: var(--shiki-color-text)"> day_string </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> year </span><span style="color: var(--shiki-token-keyword)">+</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot;/&quot;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">+</span><span style="color: var(--shiki-color-text)"> month </span><span style="color: var(--shiki-token-keyword)">+</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot;/&quot;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">+</span><span style="color: var(--shiki-color-text)"> day</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">gen</span><span style="color: var(--shiki-color-text)"> date </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">date</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">day_string</span><span style="color: var(--shiki-color-text)">, </span><span style="color: var(--shiki-token-string-expression)">&quot;YMD&quot;</span><span style="color: var(--shiki-color-text)">)</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">format</span><span style="color: var(--shiki-color-text)"> date </span><span style="color: var(--shiki-token-keyword)">%</span><span style="color: var(--shiki-color-text)">td</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* Pull out year (quarter, month, etc. work too)</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">gen</span><span style="color: var(--shiki-color-text)"> the_year </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">year</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">date</span><span style="color: var(--shiki-color-text)">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* Shift forward 7 days</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">replace</span><span style="color: var(--shiki-color-text)"> date </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> date </span><span style="color: var(--shiki-token-keyword)">+</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">7</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)"># Make ourselves a date variable</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, date </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">as.IDate(paste</span><span style="color: var(--shiki-token-punctuation)">(year, month, day, sep</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-string-expression)">&#39;-&#39;</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">)] </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># Pull out year (quarter, month, etc. work too)</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, the_year </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">year(</span><span style="color: var(--shiki-token-punctuation)">date</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># Shift forward 7 days</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, date </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> date </span><span style="color: var(--shiki-token-keyword)">+</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">7</span><span style="color: var(--shiki-color-text)">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></div>
</div>
<h3 id="modify-existing-variables" tabindex="-1"><a class="header-anchor" href="#modify-existing-variables" aria-hidden="true">#</a> Modify existing variables</h3>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">replace</span><span style="color: var(--shiki-color-text)"> tot_delay </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> dep_delay </span><span style="color: var(--shiki-token-keyword)">+</span><span style="color: var(--shiki-color-text)"> arr_delay </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* Conditional modification </span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">replace</span><span style="color: var(--shiki-color-text)"> distance </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> distance </span><span style="color: var(--shiki-token-keyword)">+</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> month</span><span style="color: var(--shiki-token-keyword)">==</span><span style="color: var(--shiki-token-constant)">9</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">replace</span><span style="color: var(--shiki-color-text)"> distance </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">0</span><span style="color: var(--shiki-color-text)"> in </span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)"> </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* Modify multiple variables (same function) </span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">foreach</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">x</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">of varlist</span><span style="color: var(--shiki-color-text)"> origin dest </span><span style="color: var(--shiki-token-keyword)">{</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">replace</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-color-text)">`</span><span style="color: var(--shiki-token-function)">x</span><span style="color: var(--shiki-color-text)">&#39;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-color-text)">`</span><span style="color: var(--shiki-token-function)">x</span><span style="color: var(--shiki-color-text)">&#39;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">+</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot; Airport&quot;</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-color-text)">dat[, tot_delay </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> dep_delay </span><span style="color: var(--shiki-token-keyword)">+</span><span style="color: var(--shiki-color-text)"> arr_delay] </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># Conditional modification </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[month</span><span style="color: var(--shiki-token-keyword)">==</span><span style="color: var(--shiki-token-constant)">9</span><span style="color: var(--shiki-color-text)">, distance </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> distance </span><span style="color: var(--shiki-token-keyword)">+</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)">]</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[</span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)">, distance </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">0</span><span style="color: var(--shiki-color-text)">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># Modify multiple variables (same function) </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">cols </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">c</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;origin&#39;</span><span style="color: var(--shiki-color-text)">,</span><span style="color: var(--shiki-token-string-expression)">&#39;dest&#39;</span><span style="color: var(--shiki-color-text)">)</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, (cols) </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">lapply</span><span style="color: var(--shiki-color-text)">(.SD, \(x) </span><span style="color: var(--shiki-token-function)">paste</span><span style="color: var(--shiki-color-text)">(x,</span><span style="color: var(--shiki-token-string-expression)">&#39;Airport&#39;</span><span style="color: var(--shiki-color-text)">)),  </span><span style="color: var(--shiki-token-comment)">## Note: before R 4.1 you need function(x) instead of the \(x) shorthand </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    .SDcols </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> cols] </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># Aside: We don&#39;t normally use a gen -&gt; replace </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># workflow in R, the way we do in Stata. See the </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># &#39;Using Booleans &amp; control-flow&#39; section below.</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></div>
</div>
<h3 id="using-booleans-control-flow" tabindex="-1"><a class="header-anchor" href="#using-booleans-control-flow" aria-hidden="true">#</a> Using Booleans &amp; control-flow</h3>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">gen</span><span style="color: var(--shiki-color-text)"> long_flight </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> air_time</span><span style="color: var(--shiki-token-keyword)">&gt;</span><span style="color: var(--shiki-token-constant)">500</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">&amp;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">!</span><span style="color: var(--shiki-token-function)">missing</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">air_time</span><span style="color: var(--shiki-color-text)">) </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">gen</span><span style="color: var(--shiki-color-text)"> flight_length </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot;Long&quot;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> air_time</span><span style="color: var(--shiki-token-keyword)">&gt;</span><span style="color: var(--shiki-token-constant)">500</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">&amp;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">!</span><span style="color: var(--shiki-token-function)">missing</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">air_time</span><span style="color: var(--shiki-color-text)">)</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">replace</span><span style="color: var(--shiki-color-text)"> flight_length </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot;Short&quot;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">missing</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">flight_length</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-keyword)">&amp;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">!</span><span style="color: var(--shiki-token-function)">missing</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">air_time</span><span style="color: var(--shiki-color-text)">) </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">gen</span><span style="color: var(--shiki-color-text)"> flight_length2 </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot;Long&quot;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">!</span><span style="color: var(--shiki-token-function)">missing</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">air_time</span><span style="color: var(--shiki-color-text)">) </span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">replace</span><span style="color: var(--shiki-color-text)"> flight_length2 </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot;Med&quot;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> air_time</span><span style="color: var(--shiki-token-keyword)">&lt;=</span><span style="color: var(--shiki-token-constant)">500</span><span style="color: var(--shiki-color-text)">  </span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">replace</span><span style="color: var(--shiki-color-text)"> flight_length2 </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot;Short&quot;</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> air_time</span><span style="color: var(--shiki-token-keyword)">&lt;=</span><span style="color: var(--shiki-token-constant)">120</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-color-text)">dat[, long_flight </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> air_time</span><span style="color: var(--shiki-token-keyword)">&gt;</span><span style="color: var(--shiki-token-constant)">500</span><span style="color: var(--shiki-color-text)">] </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, flight_length </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">fifelse(</span><span style="color: var(--shiki-token-punctuation)">air_time</span><span style="color: var(--shiki-token-keyword)">&gt;</span><span style="color: var(--shiki-token-constant)">500</span><span style="color: var(--shiki-token-punctuation)">, </span><span style="color: var(--shiki-token-string-expression)">&#39;Long&#39;</span><span style="color: var(--shiki-token-punctuation)">, </span><span style="color: var(--shiki-token-string-expression)">&#39;Short&#39;</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">] </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># fifelse is like base-R ifelse, but (f)aster! </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># for nested ifelse, easier to use fcase </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, flight_length2 </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">fcase(</span><span style="color: var(--shiki-token-punctuation)">air_time</span><span style="color: var(--shiki-token-keyword)">&lt;=</span><span style="color: var(--shiki-token-constant)">120</span><span style="color: var(--shiki-token-punctuation)">, </span><span style="color: var(--shiki-token-string-expression)">&#39;Short&#39;</span><span style="color: var(--shiki-token-punctuation)">, </span></span>
<span class="line"><span style="color: var(--shiki-token-punctuation)">                              air_time</span><span style="color: var(--shiki-token-keyword)">&lt;=</span><span style="color: var(--shiki-token-constant)">500</span><span style="color: var(--shiki-token-punctuation)">, </span><span style="color: var(--shiki-token-string-expression)">&#39;Med&#39;</span><span style="color: var(--shiki-token-punctuation)">, </span></span>
<span class="line"><span style="color: var(--shiki-token-punctuation)">                              default </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-punctuation)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;Long&#39;</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></div>
</div>
<h3 id="row-wise-calculations" tabindex="-1"><a class="header-anchor" href="#row-wise-calculations" aria-hidden="true">#</a> Row-wise calculations</h3>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">* Pre-packaged row calculations: </span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">egen</span><span style="color: var(--shiki-color-text)"> tot_delay </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">rowtotal</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-keyword)">*</span><span style="color: var(--shiki-token-parameter)">_delay</span><span style="color: var(--shiki-color-text)">)</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">egen</span><span style="color: var(--shiki-color-text)"> any_delay </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">rowfirst</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-keyword)">*</span><span style="color: var(--shiki-token-parameter)">_delay</span><span style="color: var(--shiki-color-text)">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* Custom row calculations:</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* ?</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)"># Pre-packaged row calculations: </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, tot_delay </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">rowSums</span><span style="color: var(--shiki-color-text)">(.SD), .SDcols </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">patterns(</span><span style="color: var(--shiki-token-string-expression)">&#39;*_delay&#39;</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">]</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, any_delay </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">fcoalesce(</span><span style="color: var(--shiki-token-punctuation)">.SD</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">, .SDcols </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">patterns(</span><span style="color: var(--shiki-token-string-expression)">&#39;*_delay&#39;</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">] </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># Custom row calculations: </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, new_var </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">mapply</span><span style="color: var(--shiki-color-text)">(custom_func, var1, var2)] </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, new_var </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">custom_func(</span><span style="color: var(--shiki-token-punctuation)">var1, var2</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">, by</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)">.I] </span><span style="color: var(--shiki-token-comment)"># dev version only</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></div>
</div>
<h3 id="fill-in-time-series-panel-data" tabindex="-1"><a class="header-anchor" href="#fill-in-time-series-panel-data" aria-hidden="true">#</a> Fill in Time Series/Panel Data</h3>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">* Carry forward the last-known observation</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">sort</span><span style="color: var(--shiki-color-text)"> id time</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">by</span><span style="color: var(--shiki-color-text)"> id</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">replace</span><span style="color: var(--shiki-color-text)"> x </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> x[_n</span><span style="color: var(--shiki-token-keyword)">-</span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)">] </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">missing</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">x</span><span style="color: var(--shiki-color-text)">)</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* Carry back the next-known observation</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">gsort</span><span style="color: var(--shiki-color-text)"> id </span><span style="color: var(--shiki-token-keyword)">-</span><span style="color: var(--shiki-color-text)">time</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">by</span><span style="color: var(--shiki-color-text)"> id</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">replace</span><span style="color: var(--shiki-color-text)"> x </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> x[_n</span><span style="color: var(--shiki-token-keyword)">-</span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)">] </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">missing</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">x</span><span style="color: var(--shiki-color-text)">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)"># Carry forward the last-known observation</span></span>
<span class="line"><span style="color: var(--shiki-token-function)">setorder(</span><span style="color: var(--shiki-token-punctuation)">dat, id, time</span><span style="color: var(--shiki-token-function)">)</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, x </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">nafill(</span><span style="color: var(--shiki-token-punctuation)">x, type </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-punctuation)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;locf&#39;</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">, by </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> id]</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># Carry back the next-known observation</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, x </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">nafill(</span><span style="color: var(--shiki-token-punctuation)">x, type </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-punctuation)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;nocb&#39;</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">, by </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> id]</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div>
</div>
<h2 id="collapse" tabindex="-1"><a class="header-anchor" href="#collapse" aria-hidden="true">#</a> Collapse</h2>
<p>While it takes some doing in Stata to work with multiple data sets at once (and most people do not use Stata this way, and it doesn't work in old versions), using multiple datasets at once is standard in R. That means you don't need to wrap everything in <code>preserve/restore</code>. However, it also means that you'll need to (re)assign your collapsed data if you want to use it again later. E.g. <code>dat1 = dat[, mean(var1)]</code>. Also remember our earlier note about aggregating functions on columns that have missing values: Use <code>na.rm=TRUE</code> to remove these on the fly. E.g. <code>dat[, mean(var1, na.rm=TRUE)]</code>.</p>
<h3 id="collapse-with-no-grouping" tabindex="-1"><a class="header-anchor" href="#collapse-with-no-grouping" aria-hidden="true">#</a> Collapse with no grouping</h3>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">* Reminder: You&#39;ll need to use preserve/restore</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* if you want to retain the original dataset in </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* the examples that follow. </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">collapse</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">(mean)</span><span style="color: var(--shiki-color-text)"> dep_delay </span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">collapse</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">(mean)</span><span style="color: var(--shiki-color-text)"> mean_ddel</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)">dep_delay </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">collapse</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">(mean)</span><span style="color: var(--shiki-color-text)"> mean_ddel</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)">dep_delay mean_adel</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)">arr_delay </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">collapse</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">(mean)</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">*</span><span style="color: var(--shiki-color-text)">delay </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">ds</span><span style="color: var(--shiki-color-text)">, </span><span style="color: var(--shiki-token-function)">has</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">type</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-parameter)">long</span><span style="color: var(--shiki-color-text)">)</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">collapse</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">(mean)</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-color-text)">`</span><span style="color: var(--shiki-token-function)">r</span><span style="color: var(--shiki-token-comment)">(varlist)</span><span style="color: var(--shiki-color-text)">&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)"># Reminder: You&#39;ll need to (re)assign the </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># collapsed dataset if you want to use it later,</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># e.g. dat1 = dat[, mean(dep_delay)] </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, </span><span style="color: var(--shiki-token-function)">mean</span><span style="color: var(--shiki-color-text)">(dep_delay)] </span><span style="color: var(--shiki-token-comment)"># Just give me the number! As a scalar. </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, </span><span style="color: var(--shiki-token-function)">.(</span><span style="color: var(--shiki-token-punctuation)">mean_ddel</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-function)">mean</span><span style="color: var(--shiki-token-punctuation)">(dep_delay</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">)] </span><span style="color: var(--shiki-token-comment)"># Give me back a data.table (note the .() here, that&#39;s what does it) </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, </span><span style="color: var(--shiki-token-function)">.(</span><span style="color: var(--shiki-token-punctuation)">mean_ddel</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-function)">mean</span><span style="color: var(--shiki-token-punctuation)">(dep_delay</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">, mean_adel</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-function)">mean</span><span style="color: var(--shiki-color-text)">(arr_delay))]</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, </span><span style="color: var(--shiki-token-function)">lapply</span><span style="color: var(--shiki-color-text)">(.SD, mean), .SDcols</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-function)">c</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;arr_delay&#39;</span><span style="color: var(--shiki-color-text)">,</span><span style="color: var(--shiki-token-string-expression)">&#39;dep_delay&#39;</span><span style="color: var(--shiki-color-text)">)] </span><span style="color: var(--shiki-token-comment)"># same </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, </span><span style="color: var(--shiki-token-function)">lapply</span><span style="color: var(--shiki-color-text)">(.SD, mean), .SDcols</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)">arr_delay</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-color-text)">dep_delay] </span><span style="color: var(--shiki-token-comment)"># ditto </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, </span><span style="color: var(--shiki-token-function)">lapply</span><span style="color: var(--shiki-color-text)">(.SD, mean), .SDcols</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-function)">patterns(</span><span style="color: var(--shiki-token-string-expression)">&#39;delay&#39;</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">] </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-comment)"># Matches the two lines on the left</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, </span><span style="color: var(--shiki-token-function)">lapply</span><span style="color: var(--shiki-color-text)">(.SD, mean), .SDcols</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)">is.numeric]</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></div>
</div>
<h3 id="collapse-by-group" tabindex="-1"><a class="header-anchor" href="#collapse-by-group" aria-hidden="true">#</a> Collapse by group</h3>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">* Reminder: You&#39;ll need to use preserve/restore</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* if you want to retain the original dataset in </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* the examples that follow. </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">collapse</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">(mean)</span><span style="color: var(--shiki-color-text)"> arr_delay, </span><span style="color: var(--shiki-token-function)">by</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">carrier</span><span style="color: var(--shiki-color-text)">) </span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">collapse</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">(mean)</span><span style="color: var(--shiki-color-text)"> mean_adel </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> arr_delay, </span><span style="color: var(--shiki-token-function)">by</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">carrier</span><span style="color: var(--shiki-color-text)">) </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">collapse</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">(mean)</span><span style="color: var(--shiki-color-text)"> arr_delay, </span><span style="color: var(--shiki-token-function)">by</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">carrier</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-parameter)">month</span><span style="color: var(--shiki-color-text)">) </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">collapse</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">(</span><span style="color: var(--shiki-color-text)">min</span><span style="color: var(--shiki-token-keyword)">)</span><span style="color: var(--shiki-color-text)"> min_d </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> distance </span><span style="color: var(--shiki-token-keyword)">(</span><span style="color: var(--shiki-color-text)">max</span><span style="color: var(--shiki-token-keyword)">)</span><span style="color: var(--shiki-color-text)"> max_d </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> distance, </span><span style="color: var(--shiki-token-function)">by</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">origin</span><span style="color: var(--shiki-color-text)">) </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">collapse</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">(mean)</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">*</span><span style="color: var(--shiki-color-text)">_delay, </span><span style="color: var(--shiki-token-function)">by</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">origin</span><span style="color: var(--shiki-color-text)">) </span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">collapse</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">(mean)</span><span style="color: var(--shiki-color-text)"> dep_delay arr_delay air_time distance, </span><span style="color: var(--shiki-token-function)">by</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">origin</span><span style="color: var(--shiki-color-text)">) </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">egen</span><span style="color: var(--shiki-color-text)"> unique_dest </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">tag</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">dest</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-parameter)">origin</span><span style="color: var(--shiki-color-text)">) </span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">collapse</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">(sum)</span><span style="color: var(--shiki-color-text)"> unique_dest, </span><span style="color: var(--shiki-token-function)">by</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">origin</span><span style="color: var(--shiki-color-text)">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)"># Reminder: You&#39;ll need to (re)assign the </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># collapsed dataset if you want to use it later,</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># e.g. dat1 = dat[, mean(dep_delay), by=origin] </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, </span><span style="color: var(--shiki-token-function)">.(</span><span style="color: var(--shiki-token-punctuation)">arr_delay </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-punctuation)"> </span><span style="color: var(--shiki-token-function)">mean</span><span style="color: var(--shiki-token-punctuation)">(arr_delay</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">), by</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)">carrier] </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, </span><span style="color: var(--shiki-token-function)">.(</span><span style="color: var(--shiki-token-punctuation)">mean_adel </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-punctuation)"> </span><span style="color: var(--shiki-token-function)">mean</span><span style="color: var(--shiki-token-punctuation)">(arr_delay</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">), by</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)">carrier] </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, </span><span style="color: var(--shiki-token-function)">.(</span><span style="color: var(--shiki-token-punctuation)">arr_delay </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-punctuation)"> </span><span style="color: var(--shiki-token-function)">mean</span><span style="color: var(--shiki-token-punctuation)">(arr_delay</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">), by</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-function)">.(</span><span style="color: var(--shiki-token-punctuation)">carrier, month</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">] </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, </span><span style="color: var(--shiki-token-function)">.(</span><span style="color: var(--shiki-token-punctuation)">min_d </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-punctuation)"> </span><span style="color: var(--shiki-token-function)">min</span><span style="color: var(--shiki-token-punctuation)">(distance</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">, max_d </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">max</span><span style="color: var(--shiki-color-text)">(distance)), by</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)">origin] </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, </span><span style="color: var(--shiki-token-function)">lapply</span><span style="color: var(--shiki-color-text)">(.SD, mean), .SDcols</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-function)">patterns(</span><span style="color: var(--shiki-token-string-expression)">&#39;_delay&#39;</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">, by</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)">origin] </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, </span><span style="color: var(--shiki-token-function)">lapply</span><span style="color: var(--shiki-color-text)">(.SD, mean), .SDcols</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-function)">c</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;dep_delay&#39;</span><span style="color: var(--shiki-color-text)">,</span><span style="color: var(--shiki-token-string-expression)">&#39;arr_delay&#39;</span><span style="color: var(--shiki-color-text)">,</span><span style="color: var(--shiki-token-string-expression)">&#39;air_time&#39;</span><span style="color: var(--shiki-color-text)">,</span><span style="color: var(--shiki-token-string-expression)">&#39;distance&#39;</span><span style="color: var(--shiki-color-text)">), by</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)">origin] </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, </span><span style="color: var(--shiki-token-function)">lapply</span><span style="color: var(--shiki-color-text)">(.SD, mean), .SDcols </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">c</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-constant)">4</span><span style="color: var(--shiki-color-text)">,</span><span style="color: var(--shiki-token-constant)">5</span><span style="color: var(--shiki-color-text)">,</span><span style="color: var(--shiki-token-constant)">9</span><span style="color: var(--shiki-color-text)">,</span><span style="color: var(--shiki-token-constant)">10</span><span style="color: var(--shiki-color-text)">), by</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)">origin] </span><span style="color: var(--shiki-token-comment)"># same as above </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># Matches the final two lines on the left: </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, </span><span style="color: var(--shiki-token-function)">.(</span><span style="color: var(--shiki-token-punctuation)">unique_dest </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-punctuation)"> </span><span style="color: var(--shiki-token-function)">uniqueN(</span><span style="color: var(--shiki-token-punctuation)">dest</span><span style="color: var(--shiki-token-function)">))</span><span style="color: var(--shiki-color-text)">, by </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> origin] </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># Bonus: You can also do complicated (grouped)</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># aggregations as part of a dcast (i.e. reshape </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># wide) call. E.g. Get the min, mean and max</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># departure and arrival delays, by origin airport.</span></span>
<span class="line"><span style="color: var(--shiki-token-function)">dcast(</span><span style="color: var(--shiki-token-punctuation)">dat, origin</span><span style="color: var(--shiki-token-keyword)">~</span><span style="color: var(--shiki-token-punctuation)">., fun</span><span style="color: var(--shiki-token-keyword)">=list</span><span style="color: var(--shiki-token-punctuation)">(min,mean,max),</span></span>
<span class="line"><span style="color: var(--shiki-token-punctuation)">      value.var</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-function)">c</span><span style="color: var(--shiki-token-punctuation)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;dep_delay&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-token-string-expression)">&#39;arr_delay&#39;</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div></div>
</div>
<h3 id="count-rows" tabindex="-1"><a class="header-anchor" href="#count-rows" aria-hidden="true">#</a> Count rows</h3>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">count</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">count</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">if</span><span style="color: var(--shiki-color-text)"> month</span><span style="color: var(--shiki-token-keyword)">==</span><span style="color: var(--shiki-token-constant)">10</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* Count rows by group:</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">tabulate</span><span style="color: var(--shiki-color-text)"> origin</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-color-text)">dat[, .N] </span><span style="color: var(--shiki-token-comment)"># Or: nrow(dat) </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[month</span><span style="color: var(--shiki-token-keyword)">==</span><span style="color: var(--shiki-token-constant)">10</span><span style="color: var(--shiki-color-text)">, .N] </span><span style="color: var(--shiki-token-comment)"># Or: nrow(dat[month==10]</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># Count rows by group:</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, .N, by </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> origin]</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div>
</div>
<h3 id="grouped-calculations-and-complex-objects-inside-a-data-table" tabindex="-1"><a class="header-anchor" href="#grouped-calculations-and-complex-objects-inside-a-data-table" aria-hidden="true">#</a> Grouped calculations and complex objects inside a data.table</h3>
<p>data.tables support list columns, so you can have complex objects like regression models inside a data.table. Among many other things, this means you can nest simulations inside a data.table as easily as you would perform any other (grouped) operation.</p>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">* ??</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)"># Example: Grouped regression </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># Let&#39;s run a separate regression of arrival delay on </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># departure delay for each month, inside our dataset </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># Just the coefficients</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-function)">.(</span><span style="color: var(--shiki-token-punctuation)">beta </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-punctuation)"> </span><span style="color: var(--shiki-token-function)">coef</span><span style="color: var(--shiki-token-punctuation)">(</span><span style="color: var(--shiki-token-function)">lm</span><span style="color: var(--shiki-token-punctuation)">(arr_delay </span><span style="color: var(--shiki-token-keyword)">~</span><span style="color: var(--shiki-token-punctuation)"> dep_delay, .SD</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">)[</span><span style="color: var(--shiki-token-constant)">2</span><span style="color: var(--shiki-color-text)">]),</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    by </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> month]</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># Keep the whole model for each month</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">mods </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> dat[,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">           </span><span style="color: var(--shiki-token-function)">.(</span><span style="color: var(--shiki-token-punctuation)">mod </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-punctuation)"> </span><span style="color: var(--shiki-token-keyword)">list</span><span style="color: var(--shiki-token-punctuation)">(</span><span style="color: var(--shiki-token-function)">lm</span><span style="color: var(--shiki-token-punctuation)">(arr_delay </span><span style="color: var(--shiki-token-keyword)">~</span><span style="color: var(--shiki-token-punctuation)"> dep_delay, .SD)</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">),</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">           by </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> month] </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># Now you can do things like put all 10 models in a </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># regression table or coefficient plot </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">modelsummary</span><span style="color: var(--shiki-token-keyword)">::</span><span style="color: var(--shiki-token-function)">msummary(</span><span style="color: var(--shiki-token-punctuation)">mods</span><span style="color: var(--shiki-token-keyword)">$</span><span style="color: var(--shiki-token-punctuation)">mod</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)"> </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">modelsummary</span><span style="color: var(--shiki-token-keyword)">::</span><span style="color: var(--shiki-token-function)">modelplot(</span><span style="color: var(--shiki-token-punctuation)">mods</span><span style="color: var(--shiki-token-keyword)">$</span><span style="color: var(--shiki-token-punctuation)">mod, coef_omit </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-punctuation)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;Inter&#39;</span><span style="color: var(--shiki-token-function)">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></div>
</div>
<h2 id="reshape" tabindex="-1"><a class="header-anchor" href="#reshape" aria-hidden="true">#</a> Reshape</h2>
<h3 id="reshape-prep-this-dataset-only" tabindex="-1"><a class="header-anchor" href="#reshape-prep-this-dataset-only" aria-hidden="true">#</a> Reshape prep (this dataset only)</h3>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">* We&#39;ll generate row IDs to avoid the (reshape) ambiguity </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* of repeated entries per date </span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">gen</span><span style="color: var(--shiki-color-text)"> id </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> _n </span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* For the Stata reshape, it&#39;s also going to prove </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* convenient to rename the delay vars. </span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">rename</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">(</span><span style="color: var(--shiki-color-text)">dep_delay arr_delay</span><span style="color: var(--shiki-token-keyword)">)</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">(</span><span style="color: var(--shiki-color-text)">delay_dep delay_arr</span><span style="color: var(--shiki-token-keyword)">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)"># We&#39;ll generate row IDs to avoid the (reshape) ambiguity </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># of repeated entries per date </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, id </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> .I] </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div>
</div>
<h3 id="reshape-long" tabindex="-1"><a class="header-anchor" href="#reshape-long" aria-hidden="true">#</a> Reshape long</h3>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">reshape</span><span style="color: var(--shiki-color-text)"> long delay_, </span><span style="color: var(--shiki-token-function)">i</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">id</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-function)">j</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">delay_type</span><span style="color: var(--shiki-color-text)">) s</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-color-text)">ldat </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">melt(</span><span style="color: var(--shiki-token-punctuation)">dat, measure</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-function)">patterns(</span><span style="color: var(--shiki-token-string-expression)">&#39;_delay&#39;</span><span style="color: var(--shiki-token-function)">))</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># Aside: you can also choose different names for your</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># new reshaped columns if you&#39;d like, e.g. </span></span>
<span class="line"><span style="color: var(--shiki-token-function)">melt(</span><span style="color: var(--shiki-token-punctuation)">dat, measure</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-function)">patterns(</span><span style="color: var(--shiki-token-string-expression)">&#39;_delay&#39;</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-token-punctuation)">, variable</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-string-expression)">&#39;d_type&#39;</span><span style="color: var(--shiki-token-function)">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div>
</div>
<h3 id="reshape-wide" tabindex="-1"><a class="header-anchor" href="#reshape-wide" aria-hidden="true">#</a> Reshape wide</h3>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">* This starts with the reshaped-long data from above</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">reshape</span><span style="color: var(--shiki-color-text)"> wide delay_, </span><span style="color: var(--shiki-token-function)">i</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">id</span><span style="color: var(--shiki-color-text)">) </span><span style="color: var(--shiki-token-function)">j</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-parameter)">delay_type</span><span style="color: var(--shiki-color-text)">) s</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)"># This starts with the reshaped-long data from above</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">wdat </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">dcast(</span><span style="color: var(--shiki-token-punctuation)">ldat, ... </span><span style="color: var(--shiki-token-keyword)">~</span><span style="color: var(--shiki-token-punctuation)"> variable</span><span style="color: var(--shiki-token-function)">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># Aside 1: If you only want to keep the id &amp; *_delay cols</span></span>
<span class="line"><span style="color: var(--shiki-token-function)">dcast(</span><span style="color: var(--shiki-token-punctuation)">ldat, id </span><span style="color: var(--shiki-token-keyword)">~</span><span style="color: var(--shiki-token-punctuation)"> variable</span><span style="color: var(--shiki-token-function)">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># Aside 2: It&#39;s also possible to perform complex and </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># powerful data aggregating tasks as part of the dcast </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># (i.e. reshape wide) call.</span></span>
<span class="line"><span style="color: var(--shiki-token-function)">dcast(</span><span style="color: var(--shiki-token-punctuation)">dat, origin</span><span style="color: var(--shiki-token-keyword)">~</span><span style="color: var(--shiki-token-punctuation)">., fun</span><span style="color: var(--shiki-token-keyword)">=list</span><span style="color: var(--shiki-token-punctuation)">(min,mean,max),</span></span>
<span class="line"><span style="color: var(--shiki-token-punctuation)">      value.var</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-function)">c</span><span style="color: var(--shiki-token-punctuation)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;dep_delay&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span><span style="color: var(--shiki-token-string-expression)">&#39;arr_delay&#39;</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></div>
</div>
<h2 id="merge" tabindex="-1"><a class="header-anchor" href="#merge" aria-hidden="true">#</a> Merge</h2>
<h3 id="import-and-prep-secondary-dataset-on-airport-characterists" tabindex="-1"><a class="header-anchor" href="#import-and-prep-secondary-dataset-on-airport-characterists" aria-hidden="true">#</a> Import and prep secondary dataset on airport characterists</h3>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-color-text)">import delimited using </span><span style="color: var(--shiki-token-string-expression)">&quot;https://vincentarelbundock.github.io/Rdatasets/csv/nycflights13/airports.csv&quot;</span><span style="color: var(--shiki-color-text)">, </span><span style="color: var(--shiki-token-keyword)">clear</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* Stata requires that merge ID variables have the same </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)">* name across datasets. </span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">rename</span><span style="color: var(--shiki-color-text)"> faa dest </span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">save</span><span style="color: var(--shiki-color-text)"> dat2.dta, replace</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">import delimited using </span><span style="color: var(--shiki-token-string-expression)">&quot;https://raw.githubusercontent.com/Rdatatable/data.table/master/vignettes/flights14.csv&quot;</span><span style="color: var(--shiki-color-text)">, </span><span style="color: var(--shiki-token-keyword)">clear</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-color-text)">dat2 </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">fread(</span><span style="color: var(--shiki-token-string-expression)">&quot;https://vincentarelbundock.github.io/Rdatasets/csv/nycflights13/airports.csv&quot;</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)"> </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># R _doesn&#39;t_ require that merge ID variables share the </span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># same name across datasets. But we&#39;ll add this anyway.</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat2[, dest </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> faa]</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div>
</div>
<h3 id="inner-merge-i-e-keep-row-matches-only" tabindex="-1"><a class="header-anchor" href="#inner-merge-i-e-keep-row-matches-only" aria-hidden="true">#</a> Inner merge (i.e. keep row matches only)</h3>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">merge</span><span style="color: var(--shiki-color-text)"> m</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)"> dest using dat2.dta, </span><span style="color: var(--shiki-token-function)">keep</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-constant)">3</span><span style="color: var(--shiki-color-text)">) nogen</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-color-text)">mdat </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">merge</span><span style="color: var(--shiki-color-text)">(dat, dat2, by</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-string-expression)">&#39;dest&#39;</span><span style="color: var(--shiki-color-text)">) </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div>
</div>
<h3 id="full-merge-i-e-keep-all-rows" tabindex="-1"><a class="header-anchor" href="#full-merge-i-e-keep-all-rows" aria-hidden="true">#</a> Full merge (i.e. keep all rows)</h3>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">merge</span><span style="color: var(--shiki-color-text)"> m</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)"> dest using dat2.dta, nogen</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-color-text)">mdat </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">merge</span><span style="color: var(--shiki-color-text)">(dat, dat2, by</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-string-expression)">&#39;dest&#39;</span><span style="color: var(--shiki-color-text)">, all</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-constant)">TRUE</span><span style="color: var(--shiki-color-text)">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div>
</div>
<h3 id="left-merge-i-e-keep-all-rows-from-main-dataset" tabindex="-1"><a class="header-anchor" href="#left-merge-i-e-keep-all-rows-from-main-dataset" aria-hidden="true">#</a> Left merge (i.e. keep all rows from &quot;main&quot; dataset)</h3>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">merge</span><span style="color: var(--shiki-color-text)"> m</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)"> dest using dat2.dta, </span><span style="color: var(--shiki-token-function)">keep</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">3</span><span style="color: var(--shiki-color-text)">) nogen</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-color-text)">mdat </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">merge</span><span style="color: var(--shiki-color-text)">(dat, dat2, by</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-string-expression)">&#39;dest&#39;</span><span style="color: var(--shiki-color-text)">, all.x</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-constant)">TRUE</span><span style="color: var(--shiki-color-text)">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div>
</div>
<h3 id="right-merge-i-e-keep-all-rows-from-secondary-dataset" tabindex="-1"><a class="header-anchor" href="#right-merge-i-e-keep-all-rows-from-secondary-dataset" aria-hidden="true">#</a> Right merge (i.e. keep all rows from &quot;secondary&quot; dataset)</h3>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">merge</span><span style="color: var(--shiki-color-text)"> m</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)"> dest using dat2.dta, </span><span style="color: var(--shiki-token-function)">keep</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-constant)">2</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">3</span><span style="color: var(--shiki-color-text)">) nogen</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-color-text)">mdat </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">merge</span><span style="color: var(--shiki-color-text)">(dat, dat2, by</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-string-expression)">&#39;dest&#39;</span><span style="color: var(--shiki-color-text)">, all.y</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-constant)">TRUE</span><span style="color: var(--shiki-color-text)">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div>
</div>
<h3 id="anti-merge-i-e-keep-non-matched-rows-only" tabindex="-1"><a class="header-anchor" href="#anti-merge-i-e-keep-non-matched-rows-only" aria-hidden="true">#</a> Anti merge (i.e. keep non-matched rows only)</h3>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-keyword)">merge</span><span style="color: var(--shiki-color-text)"> m</span><span style="color: var(--shiki-token-keyword)">:</span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)"> dest using dat2.dta, </span><span style="color: var(--shiki-token-function)">keep</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">2</span><span style="color: var(--shiki-color-text)">) nogen</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-color-text)">mdat </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> dat[</span><span style="color: var(--shiki-token-keyword)">!</span><span style="color: var(--shiki-color-text)">dat2, on</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-string-expression)">&#39;dest&#39;</span><span style="color: var(--shiki-color-text)">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div>
</div>
<h3 id="advanced-merges-tips-and-tricks" tabindex="-1"><a class="header-anchor" href="#advanced-merges-tips-and-tricks" aria-hidden="true">#</a> Advanced merges (tips and tricks)</h3>
<p>These next few examples are meant to highlight some specific data.table merge tricks. They don't really have good Stata equivalents (that we're aware of).</p>
<h4 id="merge-on-different-id-names" tabindex="-1"><a class="header-anchor" href="#merge-on-different-id-names" aria-hidden="true">#</a> Merge on different ID names</h4>
<div class='code--container grid-cols-1'>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-color-text)">mdat </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">merge</span><span style="color: var(--shiki-color-text)">(dat, dat2, by.x</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-string-expression)">&#39;dest&#39;</span><span style="color: var(--shiki-color-text)">, by.y</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-string-expression)">&#39;faa&#39;</span><span style="color: var(--shiki-color-text)">) </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div>
</div>
<h4 id="set-keys-for-even-faster-merges-and-syntax-shortcuts" tabindex="-1"><a class="header-anchor" href="#set-keys-for-even-faster-merges-and-syntax-shortcuts" aria-hidden="true">#</a> Set keys for even faster merges and syntax shortcuts</h4>
<div class='code--container grid-cols-1'>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-function)">setkey(</span><span style="color: var(--shiki-token-punctuation)">dat, dest</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">; </span><span style="color: var(--shiki-token-function)">setkey(</span><span style="color: var(--shiki-token-punctuation)">dat2, dest</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)"> </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">mdat </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">merge</span><span style="color: var(--shiki-color-text)">(dat, dat2) </span><span style="color: var(--shiki-token-comment)">## note: don&#39;t need &#39;by&#39; </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div>
</div>
<h4 id="non-equi-joins" tabindex="-1"><a class="header-anchor" href="#non-equi-joins" aria-hidden="true">#</a> Non-equi joins</h4>
<p>Non-equi joins are a bit hard to understand if you've never seen them before. But they are incredibly powerful and solve a suprisingly common problem: Merging datasets over a range (e.g. start to end dates), rather than exact matches. Simple example where we want to subset the 1st qtr flights for American Airlines and 2nd qtr flights for United Airlines:</p>
<div class='code--container grid-cols-1'>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-color-text)">dat3 </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">data.table(</span><span style="color: var(--shiki-token-punctuation)">carrier     = </span><span style="color: var(--shiki-token-function)">c</span><span style="color: var(--shiki-token-punctuation)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;AA&#39;</span><span style="color: var(--shiki-token-punctuation)">, </span><span style="color: var(--shiki-token-string-expression)">&#39;UA&#39;</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">                  start_month </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">c</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-constant)">1</span><span style="color: var(--shiki-color-text)">, </span><span style="color: var(--shiki-token-constant)">4</span><span style="color: var(--shiki-color-text)">),</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">                  end_month   </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">c</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-constant)">3</span><span style="color: var(--shiki-color-text)">, </span><span style="color: var(--shiki-token-constant)">6</span><span style="color: var(--shiki-color-text)">)) </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[dat3, on </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">.(</span><span style="color: var(--shiki-token-punctuation)">carrier,</span></span>
<span class="line"><span style="color: var(--shiki-token-punctuation)">                 month </span><span style="color: var(--shiki-token-keyword)">&gt;=</span><span style="color: var(--shiki-token-punctuation)"> start_month,</span></span>
<span class="line"><span style="color: var(--shiki-token-punctuation)">                 month </span><span style="color: var(--shiki-token-keyword)">&lt;=</span><span style="color: var(--shiki-token-punctuation)"> end_month</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">] </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div>
</div>
<h4 id="rolling-joins" tabindex="-1"><a class="header-anchor" href="#rolling-joins" aria-hidden="true">#</a> Rolling Joins</h4>
<p>Rolling joins are similar and allow you to match a set of dates forwards or backwards. For example, our <code>dat</code>  datset ends in October. Let's say we want to carry the  last known entries for American and United Airlines  forward to (random) future dates.</p>
<div class='code--container grid-cols-1'>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-color-text)">dat4 </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">data.table(</span><span style="color: var(--shiki-token-punctuation)">carrier  = </span><span style="color: var(--shiki-token-function)">c</span><span style="color: var(--shiki-token-punctuation)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;AA&#39;</span><span style="color: var(--shiki-token-punctuation)">, </span><span style="color: var(--shiki-token-string-expression)">&#39;UA&#39;</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">                  new_date </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">as.IDate(c</span><span style="color: var(--shiki-token-punctuation)">(</span><span style="color: var(--shiki-token-string-expression)">&#39;2014-11-01&#39;</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color: var(--shiki-token-punctuation)">                                        </span><span style="color: var(--shiki-token-string-expression)">&#39;2014-11-15&#39;</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">)) </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[, date </span><span style="color: var(--shiki-token-keyword)">:=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">as.IDate(paste</span><span style="color: var(--shiki-token-punctuation)">(year, month, day, sep</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-string-expression)">&#39;-&#39;</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">)] </span></span>
<span class="line"><span style="color: var(--shiki-color-text)">dat[dat4, on </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">.(</span><span style="color: var(--shiki-token-punctuation)">carrier, date</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-punctuation)">new_date</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)">, roll</span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-token-string-expression)">&#39;nearest&#39;</span><span style="color: var(--shiki-color-text)">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div>
</div>
<h3 id="appending-data" tabindex="-1"><a class="header-anchor" href="#appending-data" aria-hidden="true">#</a> Appending data</h3>
<div class='code--container'>
<div>
<div class="language-stata ext-stata line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">* This just appends the flights data to itself</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">save</span><span style="color: var(--shiki-color-text)"> data_to_append.dta, replace</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">append</span><span style="color: var(--shiki-color-text)"> using data_to_append.dta</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div>
<div>
<div class="language-r ext-r line-numbers-mode"><pre v-pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)"># This just appends the flights data to itself</span></span>
<span class="line"><span style="color: var(--shiki-token-function)">rbindlist(</span><span style="color: var(--shiki-token-keyword)">list</span><span style="color: var(--shiki-token-punctuation)">(dat, dat)</span><span style="color: var(--shiki-token-function)">)</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-comment)"># Or rbind(dat, dat)</span></span>
<span class="line"><span style="color: var(--shiki-token-comment)"># The fill = TRUE option is handy if the one data set has columns the other doesn&#39;t</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div>
</div>
</template>
